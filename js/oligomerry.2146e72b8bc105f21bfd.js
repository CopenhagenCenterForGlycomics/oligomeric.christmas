/*! For license information please see oligomerry.2146e72b8bc105f21bfd.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([["oligomerry"],{"+kXl":function(e,t,r){"use strict";r.r(t),r.d(t,"calculateSiblingOrder",(function(){return p})),r.d(t,"default",(function(){return x})),r.d(t,"StrictMonosaccharide",(function(){return w}));var n={O:-100,N:-200},i=Symbol("anomer"),a=Symbol("identifier"),o=Symbol("parent_linkage"),s=Symbol("parent"),h=Symbol("unknown_count"),l=(e,t,r)=>r.indexOf(e)===t,c=function e(t){return 0==t.children.length?[t]:Array.prototype.concat.apply([],t.children.map(e))},d=function(e,t){for(var r=[t];e.indexOf(r[0])<0;)r.unshift(r[0].parent);return r},f=function(e,t){return e.parent.linkageOf(e)!==t.parent.linkageOf(t)?e.parent.linkageOf(e)-t.parent.linkageOf(t):e.identifier!==t.identifier?e.identifier.toUpperCase()<t.identifier.toUpperCase()?-1:1:0},u=function(e,t){for(var r=[].concat(e),n=[].concat(t);r.length>0&&n.length>0;){var i=r.shift(),a=n.shift(),o=f(i,a);if(o)return o}return-1*(r.length-n.length)},p=function(e){var t=[];for(var r of e)t=t.concat(c(r));return t.map(d.bind(null,e)).sort(u).map(e=>e[0]).filter(l)},g=new WeakMap,v=new WeakMap,m=new WeakMap;class x{static get LINKAGES(){return n}constructor(e){if(!e)throw new Error("Missing identifier");this[a]=e}get depth(){for(var e=this,t=1;e.parent;)t++,e=e.parent;return t}get identifier(){return this[a]}get anomer(){return this[i]}set anomer(e){this[i]=e}get parent_linkage(){return this[o]}set parent_linkage(e){this[o]=e}get parent(){return this[s]}get children(){return Object.freeze([].concat(v.get(this)||[]))}get child_linkages(){var e=new Map;return this.children.forEach((function(t){var r=g.get(t),n=r;r>100&&(n=0);var i=e.get(n);i||(i=[],e.set(n,i)),i.push(t)})),e}get siblings(){var e=this;return this.parent?this.parent.children.filter(t=>t!==e):[]}balance(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(Object.isFrozen(this))throw new TypeError("Cannot balance child ordering of frozen monosaccharide");var t=p(this.children);this[h]=0;var r=0;for(var n of t)g.get(n)>100&&(r+=1,g.set(n,101+r));this[h]=r,v.set(this,t);var i=this;if(e)for(;i&&i.parent;){var a=i.parent.linkageOf(i);i.parent.child_linkages.get(a).length>0&&i.parent.balance(!1),i=i.parent}}addChild(e,t){if(Object.isFrozen(this)||Object.isFrozen(t))throw new TypeError("Cannot add child on frozen monosaccharide");if("number"!=typeof e)throw new Error("Linkage must be number");if(e>100)throw new Error("Cannot set defined linkage greater than ".concat(100));if(0==e){this[h]=this[h]||0;var r=this[h];this[h]=r+1,e=101+r}var n=0;for(var i of this.children){if(!(g.get(i)<=e))break;n+=1}g.set(t,e);var a=v.get(this)||[];a.splice(n,0,t),v.set(this,a),t[s]=this}removeChild(e,t){if(Object.isFrozen(this))throw new TypeError("Cannot remove child on frozen monosaccharide");var r=v.get(this),n=t=>{r.splice(r.indexOf(t),1),g.delete(t),t[s]=null,0==e&&(this[h]-=1)},i=e=>!t||e===t;for(var[a,o]of this.child_linkages)e==a&&o.filter(i).forEach(n)}replaceChild(e,t,r){if(Object.isFrozen(this)||Object.isFrozen(t)||Object.isFrozen(e))throw new TypeError("Cannot replace child on frozen monosaccharide");var n=this.linkageOf(e),i=e.parent_linkage,a=e.anomer;this.removeChild(n,e),t.parent_linkage=i,t.anomer=a,void 0!==r?this.addChild(r,t):this.addChild(n,t)}linkageOf(e){this.child_linkages;var t,r=this.child_linkages.entries();for(t of r)if(t[1].indexOf(e)>=0)return t[0]}graft(e){if(Object.isFrozen(this)||Object.isFrozen(e))throw new TypeError("Cannot graft child on frozen monosaccharide");var t=e.parent,r=t.linkageOf(e);t.removeChild(r,e),this.addChild(r,e)}childAt(e){var t=this.child_linkages.get(e);return t?t[0]:t}toString(){return this.identifier}valueOf(){return this.identifier}setTag(e,t){m.has(this)||m.set(this,new Map);var r=m.get(this),n="symbol"==typeof e?e:Symbol(e);return r.set(n,void 0===t||t),null===t&&r.delete(n),n}getTag(e){if(m.has(this))return m.get(this).get(e)}copyTagsFrom(e){m.has(this)||m.set(this,new Map);var t=m.get(this);for(var r of(m.get(e)||new Map).keys())t.set(r,m.get(e).get(r))}clone(){var e=new this.constructor(this.identifier);return e[i]=this[i],e[o]=this[o],e.copyTagsFrom(this),e}toSugar(e){var t=new e;t.root=this;var r=t.clone();return t.root=null,r}}var y=e=>class extends e{addChild(e,t){return this.childAt(e)&&this.removeChild(e),super.addChild(e,t)}};class w extends(y(x)){}},0:function(e,t,r){e.exports=r("J5P+")},"6cUb":function(e,t,r){"use strict";r.r(t),function(e){var n=r("ObVx"),i=r("zHDQ"),a=r("XJ90"),o=r("nZtj"),s=r("qjPz");function h(e,t,r,n,i,a,o){try{var s=e[a](o),h=s.value}catch(e){return void r(e)}s.done?t(h):Promise.resolve(h).then(n,i)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){h(a,n,i,o,s,"next",e)}function s(e){h(a,n,i,o,s,"throw",e)}o(void 0)}))}}var c=Symbol("document_container"),d="object"!=typeof e||"object"!=typeof e.versions||void 0===e.versions.node?r("eJvt").default:"",f=Object(i.default)("glycanjs:canvasrenderer"),u=Symbol("done_tween"),p=(e,t)=>(e.x.push(t[0]),e.y.push(t[1]),e);class g{constructor(e){this._mat=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),this._mat.a=e[0],this._mat.b=e[1],this._mat.c=e[2],this._mat.d=e[3],this._mat.e=e[4],this._mat.f=e[5]}applyToPoint(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGPoint();return r.x=e,r.y=t,r.matrixTransform(this._mat)}inverse(){var e=this._mat.inverse(),t=[e.a,e.b,e.c,e.d,e.e,e.f];return new g(t)}multiply(e){var t=this._mat.multiply(e._mat),r=[t.a,t.b,t.c,t.d,t.e,t.f];return new g(r)}}var v,m=function(e,t){var r=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:[],y:[]};if(t.torender){for(var n of t.torender)r=e(n,r);return r}return t.x2&&(p(r,[t.x,t.y]),p(r,[t.x2,t.y2])),t.width&&(p(r,[t.x,t.y]),p(r,[t.x+t.width,t.y+t.height])),t.text&&(p(r,[t.x,t.y]),p(r,[t.x,t.y])),r}(t);r.x=r.x.map((e,t,r)=>{if(t%2==0)return.5*(e+r[t+1])}).filter(e=>void 0!==e),r.y=r.y.map((e,t,r)=>{if(t%2==0)return.5*(e+r[t+1])}).filter(e=>void 0!==e);var n=Math.min(...r.x)-100,i=Math.max(...r.x)+100,a=Math.min(...r.y)-100,o=Math.max(...r.y)+100;e.width=1*(i-n),e.height=1*(o-a);var h,l=e.getContext("2d"),{width:c,height:d}=e.getBoundingClientRect(),f=e.height,u=d||1,v=e.width,m=c||1;if(f>v){var x=new g([f/u,0,0,f/u,0,0]).multiply(new g([1,0,0,1,-.5*m,0]));h=new g([1,0,0,1,.5*v,0]).multiply(x)}else{var y=new g([v/m,0,0,v/m,0,0]).multiply(new g([1,0,0,1,0,-.5*u]));h=new g([1,0,0,1,0,.5*f]).multiply(y)}l.setTransform(1,0,0,1,-1*n,-1*a),e.cm=new s.default(l,{handleScale:!1,handleTransforms:!0,matrix:new g([1,0,0,1,-1*n,-1*a])}),e.cm.centering_matrix=h,e.screenToCanvasMatrix=new g([1,0,0,1,-1*n,-1*a]).inverse().multiply(h),function e(t,r){if(r.torender)for(var n of r.torender)e(t,n);else r.render&&r.render(t)}(e,t)},x=e=>{var t={};if(t.fill=e.getAttribute("fill"),e.getAttribute("stroke-width")&&parseFloat(e.getAttribute("stroke-width"))>0&&(t.stroke=e.getAttribute("stroke")),e.getAttribute("transform")){var[r,n,i,a]=e.getAttribute("transform").match(/rotate\((\d+),(\d+),(\d+)\)/);r.length>0&&(t.rotate={angle:n,cx:i,cy:a})}return t},y=e=>{var t=[];for(var r of e.querySelectorAll("path")){var n=x(r);n.d=r.getAttribute("d"),t.push(n)}for(var i of e.querySelectorAll("circle")){var a=x(i);a.cx=parseFloat(i.getAttribute("cx")),a.cy=parseFloat(i.getAttribute("cy")),a.r=parseFloat(i.getAttribute("r")),t.push(a)}for(var o of e.querySelectorAll("rect")){var s=x(o),h=o.getAttribute("x"),l=o.getAttribute("y"),c=parseFloat(o.getAttribute("x"))+parseFloat(o.getAttribute("width")),d=parseFloat(o.getAttribute("y"))+parseFloat(o.getAttribute("height"));s.d="M".concat(h,",").concat(l," ").concat(c,",").concat(l," ").concat(c,",").concat(d," ").concat(h,",").concat(d," z"),t.push(s)}for(var f of e.querySelectorAll("polyline")){var u=x(f);u.d="M"+f.getAttribute("points")+"Z",t.push(u)}for(var p of e.querySelectorAll("text")){var g=x(p);g.fontSize=p.getAttribute("font-size"),g.text=p.textContent;var v=p.getAttribute("x"),m=p.getAttribute("y");g.x=v,g.y=m,t.push(g)}return t},w=Symbol("global_symbols"),b=Symbol("performing_import"),k=new WeakMap,_=function(e,t){if(t.clientX){var r=e.getBoundingClientRect(),n=e.screenToCanvasMatrix.applyToPoint(t.clientX-r.x,t.clientY-r.y),i=n.x/100,a=n.y/100;t.sugarX=i,t.sugarY=a}},O=(e,t,r)=>(t*=100,(e*=100)>=r.x&&e<=r.x+r.width&&t>=r.y&&t<=r.y+r.height),C=(e,t)=>({left:e,top:t,width:0,height:0}),A=function(e){if(e.sugarX||e.sugarY){var t=[...this.iconset].filter(O.bind(null,e.sugarX,e.sugarY)),r=e.type;for(var n of t)if(n.hasElement()){e.stopImmediatePropagation();var i=new Event(r,{bubbles:!0});return n.element.getBoundingClientRect=C.bind(null,e.clientX,e.clientY),n.element.dispatchEvent(i),void("dragover"===r&&this.last_dragenter!==n&&(this.last_dragenter&&(delete this.last_dragenter,i=new Event("dragleave",{bubbles:!0}),n.element.dispatchEvent(i)),i=new Event("dragenter",{bubbles:!0}),n.element.dispatchEvent(i),this.last_dragenter=n))}if(t.length<1&&"dragover"===r&&this.last_dragenter){var a=new Event("dragleave",{bubbles:!0});this.last_dragenter.element.dispatchEvent(a),delete this.last_dragenter}}};class M extends a.default{constructor(e,t){var r;if(f("CanvasRenderer"),super(e,t),Object(n.autoPlay)(!0),this.iconset=new Set,Object(n.onTick)(()=>{this.animating&&this.paint()}),this.ready=v.call(this),e)for(var i of(e instanceof HTMLCanvasElement?r=e:(this[c]=e,f.info("Creating canvas element"),(r=e.ownerDocument.createElement("canvas")).setAttribute("width","1px"),r.setAttribute("height","1px"),e.appendChild(r)),this.element=new o.default(r),function(e,t){for(var r of"mousemove mousedown mouseup click touchstart touchend touchmove drop dragover".split(" "))e.addEventListener(r,t,{passive:!0,capture:!0})}(this.element.canvas,_.bind(this,this.element.canvas)),["click","dragover"]))this.element.canvas.addEventListener(i,A.bind(this),{capture:!0})}static get Canvas(){return o.default}static get SYMBOLS(){return d}static get GLOBAL_SCALE(){return 100}get animating(){for(var e of this.iconset)if(!e.rendered)return!0;return!1}setupContainer(e,t){var r=this.element;if(e||(e=r.group(),this.rendered.set(t,e)),this.groupTag&&!e.tagGroup&&(e.tagGroup=e.group()),e.tagGroup)for(var n of e.tagGroup.element.childNodes)e.appendChild(n);return e}renderLinkageGroup(e){return e.group()}renderLinkageLabel(e,t,r,n,i,a){var o=e.text(t,r,n);return!i&&a<0&&(o["text-anchor"]="end"),o}removeRendered(e){e.residue&&(e.residue.parent.remove(e.residue),e.residue.element&&e.residue.element.parentNode.removeChild(e.residue.element),this.iconset.has(e.residue)&&this.iconset.delete(e.residue)),e.linkage&&e.linkage.parent.remove(e.linkage)}setIconPosition(e,t,r,i,a,o){k.get(e)||k.set(e,new n.Tween(e));var s=k.get(e),h=200;e.rendered=!1,clearTimeout(e[u]),e.x!==t||e.y!==r||e.width!==i||e.height!==a?(this.iconset.has(e)||(this.iconset.add(e),e.x=t,e.y=r,e.width=i,e.height=a,e.rotate=o,h=0,e.rendered=!0),s.to({x:t,y:r,width:i,height:a,rotate:o},h).on("complete",e=>{e[u]=setTimeout(()=>{e.rendered=!0},0)}).start()):e.rendered=!0}screenCoordinatesFromLayout(e){var t=this.element.canvas,r={x:0,y:0},n=e.x+e.width,i=e.y+e.height;r.x=100*e.x,r.y=100*e.y;var a=t.screenToCanvasMatrix.inverse().applyToPoint(r.x,r.y);return e.x=a.x,e.y=a.y,r.x=100*n,r.y=100*i,a=t.screenToCanvasMatrix.inverse().applyToPoint(r.x,r.y),e.width=a.x-e.x,e.height=a.y-e.y,e.x+=t.getBoundingClientRect().x,e.y+=t.getBoundingClientRect().y,e}renderIcon(e,t){var r=e.use(t,0,0,1,1);r.src=this.symbols[t].svg,r.paths=this.symbols[t].paths;var n=this.element.canvas;return Object.defineProperty(r,"element",{get:function(){return this._element||(this._element=n.ownerDocument.createElement("button"),n.appendChild(this._element)),this._element}}),r.hasElement=()=>"_element"in r,r}scaleToFit(){}paint(){m(this.element.canvas,this.element)}refresh(){var e=this;return l((function*(){return e.ready.then(l((function*(){yield a.default.prototype.refresh.call(e),e.paint()})))}))()}}M[w]=null,M[b]=!1,v=function(){var e=document.createElement("svg");return M[b]?new Promise(e=>{setTimeout(()=>{v.call(this).then(e)},0)}):null!==M[w]?(this.symbols=M[w],Promise.resolve()):(M[b]=!0,this.symbols={},Promise.resolve().then(()=>e.innerHTML=d).then(()=>{for(var t of e.querySelectorAll("defs symbol")){var r=t.innerHTML.replace(/#/g,"%23"),n=y(t),i='data:image/svg+xml;utf8,<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" x="0" y="0" width="100px" height="100px">'.concat(r,"</svg>");this.symbols[t.getAttribute("id")]={svg:i,paths:n}}M[w]=this.symbols,M[b]=!1}))},t.default=M}.call(this,r("eeCk"))},"J5P+":function(e,t,r){"use strict";function n(e,t,r,n,i,a,o){try{var s=e[a](o),h=s.value}catch(e){return void r(e)}s.done?t(h):Promise.resolve(h).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var o=e.apply(t,r);function s(e){n(o,i,a,s,h,"next",e)}function h(e){n(o,i,a,s,h,"throw",e)}s(void 0)}))}}r.r(t);var a=window.devicePixelRatio||1,o=a>1?48*a:64*a,s=function(){var e=i((function*(){return fetch("images/tilemap_elf.png").then(e=>e.blob()).then(e=>{var t=URL.createObjectURL(e),r=new Image;return r.src=t,r})}));return function(){return e.apply(this,arguments)}}()();var h=class{constructor(e){this.canvas=e,this.x=0,this.y=0,this.rotate=0}render(){var e=this;return i((function*(){var t=yield s,r=e.canvas.getContext("2d");e.rotate<0&&(e.rotate+=360);e.rotate;r.drawImage(t,128*Math.floor(e.rotate%360/30),0,128,128,e.x-.5*o,e.y-.5*o,o,o)}))()}},l=r("EYlo");function c(e,t,r,n,i,a,o){try{var s=e[a](o),h=s.value}catch(e){return void r(e)}s.done?t(h):Promise.resolve(h).then(n,i)}var d=e=>e*(Math.PI/180),f=window.devicePixelRatio||1,u=32*f,p=32*f;CanvasRenderingContext2D.prototype.roundRect=function(e,t,r,n,i){var a=Math.PI/180;r-e-2*i<0&&(i=(r-e)/2),n-t-2*i<0&&(i=(n-t)/2),this.beginPath(),this.moveTo(e+i,t),this.lineTo(r-i,t),this.arc(r-i,t+i,i,270*a,360*a,!1),this.lineTo(r,n-i),this.arc(r-i,n-i,i,0*a,90*a,!1),this.lineTo(e+i,n),this.arc(e+i,n-i,i,90*a,180*a,!1),this.lineTo(e,t+i),this.arc(e+i,t+i,i,180*a,270*a,!1),this.closePath()};Object(l.autoPlay)(!0);var g=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n={x:this.x,y:this.y,rotate:this.rotate},i=r?{x:e,y:this.y}:{y:t,x:this.x},a=(Math.abs(t-this.y),Math.abs(e-this.x),new l.Tween(n).to(i,10/f*(Math.abs(i.x-this.x)+Math.abs(i.y-this.y))).easing(l.Easing.Linear).on("update",e=>{var{x:t,y:r}=e;this.rotate=180*Math.atan2(i.y-this.y,i.x-this.x)/Math.PI-90,this.x=t,this.y=r,n.rotate=this.rotate})),o=new l.Tween(n).to({rotate:180*Math.atan2(t-i.y,e-i.x)/Math.PI-90},500).on("update",e=>{var{rotate:t}=e;this.rotate=t}),s=new l.Tween(n).to({x:e,y:t},10/f*(Math.abs(i.x-e)+Math.abs(i.y-t))).easing(l.Easing.Linear).on("update",e=>{var{x:t,y:r}=e;this.rotate=180*Math.atan2(r-this.y,t-this.x)/Math.PI-90,this.x=t,this.y=r});return o.on("complete",()=>{s.start()}),a.on("complete",()=>{o.start()}),a.start(),new Promise(e=>{s.on("complete",e)})};var v=class extends h{constructor(e){super(e)}go_to(e,t){g.call(this,e,t)}deliverCargoAndReturn(e,t){var r,n=this;return(r=function*(){if(!n.busy){var r={x:n.x,y:n.y};n.busy=!0,yield g.call(n,e,t),n.ping&&n.ping(),n.cargo=null,yield g.call(n,r.x,r.y,!1),n.busy=!1,n.home&&(n.x=n.home.x,n.y=n.home.y)}},function(){var e=this,t=arguments;return new Promise((function(n,i){var a=r.apply(e,t);function o(e){c(a,n,i,o,s,"next",e)}function s(e){c(a,n,i,o,s,"throw",e)}o(void 0)}))})()}render(){super.render();var e=this.x+Math.floor(Math.cos(d(this.rotate+90))*u),t=this.y+Math.floor(Math.sin(d(this.rotate+90))*u),r=this.canvas.getContext("2d");((e,t,r,n)=>{var i=n.getContext("2d");i.save(),i.translate(t,r),i.fillStyle="rgba(200,200,200,0.5)",i.roundRect(-.5*o,.5*o,.5*o,o,o/10),i.fill(),i.font="".concat(16*f,"px Helvetica, sans-serif"),i.textAlign="center",i.textBaseline="middle",i.fillStyle="rgba(100,100,100,1)",i.fillText(e,0,.75*o),i.restore()})(this.name||"Nisse",this.x,this.y,this.canvas),this.cargo&&r.drawImage(this.cargo,0,0,32,32,e-.5*p,t-.5*p,p,p)}},m=r("GsCz"),x=r("+kXl"),y=r("lC8A"),w=r("VfSW"),b=r("zHDQ"),k=r("zUUD"),_=Object(b.default)("glycanjs:searching"),O=e=>[].concat.apply([],e),C=function(e,t,r){return r.indexOf(e)===t},A=function(e,t,r){for(var n=null,i=[].concat(e),a=[].concat(r);n=i.shift();){var o=i.length>0;a=a.filter(t.bind(null,n)),o&&(a=a.map(e=>e.parent)),a=a.filter(e=>null!=e)}return a.map(e=>r.indexOf(e)).map(t=>r.slice(t-e.length+1,t+1))},M=function(e,t,r){var n=e.paths(),i=t.paths(),a=[],o=new WeakMap,s=e=>e.map(e=>e[e.length-1]);return i.forEach(e=>{var t=A.bind(null,e,r),i=n.map(t);a=a.concat(O(i.map(s))).filter(C),O(O(i)).filter(C).forEach(e=>{o.set(e,(o.get(e)||0)+1)})}),a.filter(e=>o.get(e)==t.leaves().length)},S=function(e,t,r){var n=Symbol("wildcard");_.info("Wildcard matching",e.sequence,t.sequence);var i=t.composition().filter(e=>"*"===e.identifier).map(e=>e.children.map(r=>{var n=r.toSugar(t.constructor);return n.linkage=e.linkageOf(r),n.parent_link=e.parent?e.parent.linkageOf(e):0,n})),a=t.clone();a.composition().filter(e=>"*"===e.identifier).forEach(e=>{e.children.map(t=>e.removeChild(e.linkageOf(t),t)),e.setTag(n,!0)}),_.info("Root sugar for wildcard matching",a.sequence),_.info("We have",i.length,"wildcard subtrees to ensure matches for"),i.forEach(e=>e.forEach(e=>{var t=new(0,e.constructor.Monosaccharide)("*");t.addChild(e.linkage,e.root),e.root=t,_.info("Wildcard subtree sequence:",e.sequence)}));var o=M(e,a,r),s=O(o.map(t=>e.trace(a,t,r)));_.info("RESULTS from matching Root sugar, total of",s.length,"trees matched"),s.forEach(e=>{_.info("RESULT Root sugar match sequence",e.sequence);var t=e.composition_for_tag(n)[0];_.info("The residue acting as wildcard is",t,"with parent",t.parent?t.parent.identifier:"(No root)")});var h=function(e,t){var r=new WeakMap;for(var n of e)for(var i of(_.info("For a Root tree match",n.sequence,"we are finding wildcard leaves"),n.leaves()))i.getTag(t)&&(r.set(i.original,n),_.info("Adding leaf",i.original.identifier," to tree mapping"),i.parent&&(r.set(i.parent.original,n),_.info("Adding leaf parent",i.parent.original.identifier," to tree mapping")));return r}(s,n),l=i.map(t=>t.map(t=>{var i=M(e,t,r);_.info("For subtree",t.sequence,"we matched roots",i.map(e=>e.identifier)),_.info("We should be able to match each of these roots with a Root sugar match"),i=i.filter(e=>!e.parent||0==t.parent_link||e.parent.linkageOf(e)==t.parent_link).map(t=>{_.info("The parents of ",t.identifier,t.parent," are being checked for being leaves of any root tree");var r=[...e.residues_to_root(t)];for(var n of r)if(h.get(n))return{root:t,parent_leaf:n}}).filter(e=>e),_.info("Number of subtrees that are a parent of a root match",i.length);var o=i.map(i=>{var o=e.trace(t,i.root,r),s=h.get(i.parent_leaf),l=a.composition_for_tag(n)[0],c=[];for(var d of(_.info("Matched after tracing",o),o)){var f=s.clone(),u=f.composition_for_tag(n)[0];d.root.original=l,u===f.root?f.root=d.root:(d.root.copyTagsFrom(u),u.parent.replaceChild(u,d.root,0)),c.push(f)}return c});return O(o)}));return _.info("Found",O(O(l)).length,"matching trees"),O(O(l))};var T=Symbol("cache_symbol"),H={type:"wildcard"},q={type:"fixed"},E={type:"composition"},N={type:"trace"};class L extends class{static search(e,t,r){return t.composition().filter(e=>"*"===e.identifier).length>0?this.search_wildcard_paths(e,t,r):this.search_fixed_paths(e,t,r)}static search_wildcard_paths(e,t,r){return S(e,t,r)}static search_fixed_paths(e,t,r){return M(e,t,r)}}{static get Cache(){return this[T]||(this[T]=new k.default),this[T]}static search(e,t,r){if(!Object.isFrozen(e)||!Object.isFrozen(t))return super.search(e,t,r);this.Cache.has([e,E])||this.Cache.set([e,E],e.composition().map(e=>e.identifier)),this.Cache.has([t,E])||this.Cache.set([t,E],t.composition().map(e=>e.identifier));var n=this.Cache.get([t,E]),i=this.Cache.get([e,E]);return n.every(e=>"*"===e||null!==i.find(t=>t===e))?super.search(e,t,r):[]}static search_wildcard_paths(e,t,r){if(!Object.isFrozen(e)||!Object.isFrozen(t))return super.search_wildcard_paths(e,t,r);var n=[e,t,r,H];return this.Cache.has(n)?this.Cache.get(n):(this.Cache.set(n,super.search_wildcard_paths(e,t,r)),this.Cache.get(n))}static search_fixed_paths(e,t,r){if(!Object.isFrozen(e)||!Object.isFrozen(t))return super.search_fixed_paths(e,t,r);var n=[e,t,r,q];return this.Cache.has(n)?this.Cache.get(n):(this.Cache.set(n,super.search_fixed_paths(e,t,r)),this.Cache.get(n))}}var P=(e,t,r,n)=>{if(!Object.isFrozen(e)||!Object.isFrozen(t))return e.trace(t,r,n);var i=[e,t,r,n,N],a=L.Cache;return a.has(i)||a.set(i,e.trace(t,r,n)),a.get(i).map(e=>e.clone())},z=e=>{for(var t=e;t.parent;){var r=t.parent.children,n=r[r.indexOf(t)+1];if(n)return n;t=t.parent}return null},B=function*(e){for(var t=[...e.depth_first_traversal()],r=0;r<t.length;){var n=t[r],i=z(n);i||(i=n);var a=t.indexOf(i),o=t.slice(r+1,a),s=t.slice(a===r?a+1:a);if(a===r)for(var h of s)yield{root:n,chord:[n,h]};else{for(var l of s)yield{root:e.root,chord:[n,l]};for(var c of o)yield{root:n,chord:[n,c]}}r+=1}},G=function*(e,t){if(t<2)throw new Error("Cannot expand chord set when n < 2");var r=[...B(e)],n=r.filter(t=>t.root===e.root&&t.chord[0]!==e.root),i={};for(var a of n)i[a.chord[0]]=i[a.chord[0]]||[],i[a.chord[0]].push(a.chord[1]);var o=0;for(var s of r)yield s;for(;o<t-2&&r.length>0;){var h=[];for(var l of r)for(var c of i[l.chord[l.chord.length-1]]||[])if(e.composition(l.root).indexOf(c)>=0){var d={root:l.root};d.chord=l.chord.concat(c),yield d,h.push(d)}r=h,o+=1}},j=function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;t>=1&&(yield*e.depth_first_traversal(e.root,t=>({root:e.root,chord:[t]})),yield*e.depth_first_traversal(e.root,t=>t===e.root?null:{root:t,chord:[t]})),t>=2&&(yield*G(e,t))},I=Symbol("root"),F=function(e,t){for(var r=null;!(r=Object.getOwnPropertyDescriptor(e,t))&&Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return r},R=function(e,t,r){return r.indexOf(e)===t},D=(e,t)=>t.getTag(e),X=Symbol("frozen_sequence"),W=Symbol("frozen_composition");class Y{constructor(){}set root(e){this[I]=e}get root(){return this[I]}static get Monosaccharide(){return x.default}freeze(){var e=this;for(var t of this.breadth_first_traversal())Object.freeze(t);this[X]=this.sequence,this[W]=this.composition(),Object.defineProperty(this,"composition",{value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.root;return t===e.root?e[W]:e.constructor.prototype.composition.call(e,t)}}),Object.defineProperty(this,"sequence",{get:()=>this[X]}),Object.freeze(this)}get repeats(){return this.composition(this.root).filter(e=>e instanceof y.default.Monosaccharide).map(e=>e.repeat).filter((e,t,r)=>r.indexOf(e)===t)}paths(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.leaves(e),r=this;return[].concat(t).map(e=>Array.from(r.residues_to_root(e)))}leaves(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root;return this.composition(e).filter(e=>0===e.children.length)}locate_monosaccharide(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root,[,r,n]=e.match(/[a-zA-Z]+|[0-9]+/g);r=parseInt(r),n=n.charCodeAt(0)-"a".charCodeAt(0);var i=this.paths(t).map(e=>e.reverse()[r-1]).filter(e=>e).filter(R);return 1==i.length&&i[0]===t?t:i[n]}location_for_monosaccharide(e){var t=[...this.breadth_first_traversal()].filter(t=>t.depth===e.depth).indexOf(e);return"y"+e.depth+String.fromCharCode("a".charCodeAt(0)+t)}composition(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root,t=this;return e?[[e]].concat(e.children.map(e=>t.composition(e))).reduce((e,t)=>e.concat(t)):[]}composition_for_tag(e){return this.composition().filter(D.bind(null,e))}clone(e){var t=new WeakMap,r=new WeakMap,n=this.breadth_first_traversal(this.root,e);for(var i of n)if(!(i instanceof y.default.Monosaccharide&&i.repeat.root!==i)){t.has(i)||t.set(i,i.clone());var a=t.get(i);if(a instanceof y.default.Monosaccharide&&(r.set(i.repeat,a.repeat),t.set(i,a.repeat.root),a=t.get(i)),i.parent instanceof y.default.Monosaccharide&&i.parent.repeat.children.indexOf(i)>=0){var o=r.get(i.parent.repeat);new x.default("Root").addChild(i.parent.linkageOf(i),a),o.children=o.children.concat(a)}else i.parent&&t.get(i.parent)&&t.get(i.parent).addChild(i.parent.linkageOf(i),a)}var s=new this.constructor;return s.root=t.get(this.root),s}match_sugar_pattern(e,t){var r,n=L.search(this,e,t);return e.composition().map(e=>e.identifier).filter(e=>"*"===e).length>0?n:(r=n.map(r=>P(this,e,r,t)),[].concat.apply([],r))}trace(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>!0;return w.Tracer.trace(this,t,e,r)}*breadth_first_traversal(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;if(e){var r=[];for(r.push(e);r.length>0;){var n=r.shift();r=r.concat(n.children),t&&(n=t(n)),n&&(yield n)}}}*depth_first_traversal(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;if(e){var r=[];for(r.push(e);r.length>0;){var n=r.shift();r=n.children.concat(r);var i=t?t(n):n;i&&(yield i)}}}*chords(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;yield*j(this,e)}*residues_to_root(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root;for(yield e;e.parent;)e=e.parent,yield e}static CopyIO(e){var t=this,r=F(e,"sequence").set,n=F(e,"sequence").get;return class extends t{get sequence(){return n.call(this)}set sequence(e){return r.call(this,e)}}}}var V=Symbol("comment_string"),K=Symbol("is_negative"),U=Symbol("reaction_sugar"),J=Symbol("reaction_position"),Q=Symbol("reaction_position_string"),Z=(e,t)=>{if(!e||!t)return!1;if("*"===e.identifier||"*"===t.identifier)return!0;var r=((e,t)=>e.identifier===t.identifier)(e,t),n=!1;return e.parent&&t.parent&&(n=0===e.parent.linkageOf(e)||0===t.parent.linkageOf(t)||e.parent.linkageOf(e)===t.parent.linkageOf(t)),e.parent||t.parent||(n=!0),r&&n},$=e=>class extends e{get sequence(){return super.sequence.replace(/Root/,"")}set sequence(e){return super.sequence=e,super.sequence}},ee=function(e){return(e.match_sugar_pattern(this,Z)||[]).map(e=>(e.composition_for_tag(this.attachment_tag)[0]||{}).original).filter(e=>e)},te=function(e){for(var t of ee.call(this,e)){var r=this[U].clone();for(var n of r.root.children)t.graft(n)}},re=function(e){var t=[],r=Symbol("attach");for(var n of ee.call(this,e)){var i=this[U].clone();n.setTag(r,!0);var a=e.clone(),o=a.composition_for_tag(r)[0];for(var s of i.root.children)o.graft(s);n.setTag(r,null),o.setTag(r,null),t.push(a)}return t},ne=function(e,t){var r=this.delta;return e.filter(e=>0==t.trace(r,e,Z).length)};class ie extends Y{set comment(e){this[V]=e,(e=>{var t=e[V],r=!1;0===t.indexOf("!")&&(t=t.substring(1),r=!0);var[n,i]=t.split("@");n=n.replace(/[{}]/g,"");var a=new($(Y.CopyIO(e)));if(e[K]=r,a.sequence=n,e[U]=a,e[J]=((e,t)=>e.locate_monosaccharide(t))(e,i),!e[J])throw new Error("Cannot locate attachment point");e[Q]=i,e.attachment_tag=Symbol("attachment"),e[J].setTag(e.attachment_tag)})(this),this.freeze(),this.delta.freeze()}get comment(){if(!this.delta)return this[V]}get delta(){return this[U]}get negative(){return this[K]}tagSubstrateResidues(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Symbol("substrate"),r=ee.call(this,e);if(this.negative){var n=ne.call(this,r,e);r=r.filter(e=>n.indexOf(e)<0)}return r.forEach(e=>e.setTag(t)),t}tagAvailableSubstrateResidues(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Symbol("substrate"),r=ee.call(this,e),n=ne.call(this,r,e);return(r=r.filter(e=>n.indexOf(e)<0)).forEach(e=>e.setTag(t)),t}worksOn(e){var t=ee.call(this,e);return t.length<1?this.negative||!1:!this.negative||ne.call(this,t,e).length>0}execute(e){return te.call(this,e)}generate(e){return re.call(this,e)}}ie.Comparator=Z;Symbol("reactions"),Symbol("reactionset"),Object(b.default)("glycanjs:reactionset");var ae,oe;new Map;var se=e=>{if(e<0){if(e===x.default.LINKAGES.O)return"O";if(e===x.default.LINKAGES.N)return"N"}return e<=0?"?":""+e},he=e=>x.default.LINKAGES[e]?x.default.LINKAGES[e]:"?"==e?0:parseInt(e),le=(e,t)=>new(0,e.constructor.Monosaccharide)(t);ae=(e,t)=>{var r=t.shift();if(!r)throw new Error("Empty branch");var[n,i]=r.split("("),a=le(e,n);return oe(e,a,t),[a,i]},oe=(e,t,r)=>{for(var n=[],i=(e,t)=>e.addChild(t[0],t[1]);r.length>0;){var a=r.shift();if("]"==a){var[o,s]=ae(e,r),[h,l,,c]=(s||"").split("");o.anomer=h,o.parent_linkage=he(l),n.push([he(c),o])}else{if("["==a)return n.reverse().forEach(i.bind(null,t)),void(n.length=0);var[d,f]=a.split("("),[u,p,,g]=(f||"").split(""),v=le(e,d);v.anomer=u,v.parent_linkage=he(p),t.addChild(he(g),v),n.reverse().forEach(i.bind(null,t)),n.length=0,t=v}}};var ce=function(e){return e.split("").reverse().join("")},de=e=>t=>t.identifier==="Repeat".concat(e),fe=function(e){var t="";[,e,t]=e.match(/([^\+]+)(?:\+(\".+\"))*/),t=(t||"").replace(/^"/,"").replace(/"$/,"");for(var r,n=/{([^}@]+)(?:@([a-z]\d+[a-z]))?}([a-z]|\d+)/g,i=0,a={},o=e;null!==(r=n.exec(e));)o=o.replace(r[0],"Repeat".concat(++i,"(u?-?)")),a[i]={seq:r[1],attachment:r[2],variable:r[3]};(e=o).match(/[\]\)]$/)&&(e="".concat(e,"Root"));var s=(e+=")").split(/([\[\]])/);s=s.map(e=>e.split(/\)(?=[A-Za-z\*])/).reverse().join(")")).map(e=>e.match(/\d$/)?e+")":e),s=[].concat.apply([],s.map(e=>ce(e).split(")").filter(e=>e.length).map(ce))).reverse();var h=le(this,s.shift());return oe(this,h,s),this.root=h,((e,t)=>{var r=e.composition();for(var n of Object.keys(t)){var i=r.filter(de(n)).shift();if(i){var a=t[n].seq,o=1,s="";t[n].variable.match(/^\d+$/)&&(s=""+(o=parseInt(t[n].variable))),t[n].variable.match(/[a-z]/)&&(s=t[n].variable);var h=new(0,e.constructor);h.sequence=a;var l=t[n].attachment;if(!l){for(var c=h.root;c.children&&c.children.length>0;)c=c.children[0];l=h.location_for_monosaccharide(c)}var d=new y.default(h,l,1,o);s&&(d.identifier=s);var f=i.parent;f.removeChild(f.linkageOf(i),i),f.graft(d.root),i.children.length>0&&(d.children=i.children)}}})(this,a),t&&(this.comment=t),h},ue=e=>{var t=e.toString();if(e instanceof y.default.Monosaccharide){if(e.repeat.mode===y.default.MODE_MINIMAL)return"{".concat(e.repeat.template.sequence.replace(/\([a-z]\d+-$/,""));if(e.repeat.mode===y.default.MODE_EXPAND)return"".concat(t)}return t},pe=e=>e.parent?"("+e.anomer+se(e.parent_linkage)+"-":"",ge=function(e){var t=e[0];return e[1].map(e=>[t,e])},ve=e=>e instanceof y.default.Monosaccharide&&e.repeat.root===e&&e.repeat.mode===y.default.MODE_MINIMAL?(e.repeat.off_main?"@".concat(e.repeat.attachment):"")+"}".concat(e.repeat.identifier):"",me=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root;if(t){var r=[];if(t instanceof y.default.Monosaccharide&&t.repeat.mode===y.default.MODE_MINIMAL&&t.repeat.root===t){var n=t.repeat.children;r=n.length>0?[].concat.apply([],[...n[0].parent.child_linkages].map(e=>{var[t,r]=e;return[t,r.filter(e=>!(e instanceof y.default.Monosaccharide))]}).sort((e,t)=>e[0]-t[0]).map(ge)):[]}else r=[].concat.apply([],[...t.child_linkages].sort((e,t)=>e[0]-t[0]).map(ge));var i=""+r.map(t=>e.call(this,t[1])+se(t[0])+")"+ve(t[1])).reduce((e,t)=>e?e+"["+t+"]":t,""),a=i+ue(t)+pe(t);return t===this.root&&this.comment?"".concat(a,'+"').concat(this.comment,'"'):a}},xe=function(e,t){for(var r=null;!(r=Object.getOwnPropertyDescriptor(e,t))&&Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return r},ye=function(e){var t=(xe(e.prototype,"sequence")||{set:null}).set,r=function(){return me.call(this,this.root)},n={};return r&&(n.get=r),t&&(n.set=t),Object.defineProperty(e.prototype,"sequence",n),class extends e{}},we=e=>function(e){var t=(xe(e.prototype,"sequence")||{get:null}).get,r=function(e){fe.call(this,e)},n={};return t&&(n.get=t),r&&(n.set=r),Object.defineProperty(e.prototype,"sequence",n),class extends e{}}(ye((e=>class extends e{})(e)));function be(e,t,r,n){this._bounds=e,this.children=[],this.nodes=[],n&&(this._maxChildren=n),r&&(this._maxDepth=r),t&&(this._depth=t)}function ke(e,t,r,n){be.call(this,e,t,r,n),this._stuckChildren=[]}function _e(e,t,r,n){var i;i=t?new be(e,0,r,n):new ke(e,0,r,n),this.root=i}be.prototype.nodes=null,be.prototype._classConstructor=be,be.prototype.children=null,be.prototype._bounds=null,be.prototype._depth=0,be.prototype._maxChildren=4,be.prototype._maxDepth=4,be.TOP_LEFT=0,be.TOP_RIGHT=1,be.BOTTOM_LEFT=2,be.BOTTOM_RIGHT=3,be.prototype.insert=function(e){if(this.nodes.length){var t=this._findIndex(e);this.nodes[t].insert(e)}else{this.children.push(e);var r=this.children.length;if(this._depth<this._maxDepth&&r>this._maxChildren){var n;for(this.subdivide(),n=0;n<r;n++)this.insert(this.children[n]);this.children.length=0}}},be.prototype.retrieve=function(e){if(this.nodes.length){var t=this._findIndex(e);return this.nodes[t].retrieve(e)}return this.children},be.prototype._findIndex=function(e){var t=this._bounds,r=!(e.x>t.x+t.width/2),n=!(e.y>t.y+t.height/2),i=be.TOP_LEFT;return r?n||(i=be.BOTTOM_LEFT):i=n?be.TOP_RIGHT:be.BOTTOM_RIGHT,i},be.prototype.subdivide=function(){var e=this._depth+1,t=this._bounds.x,r=this._bounds.y,n=this._bounds.width/2,i=this._bounds.height/2,a=t+n,o=r+i;this.nodes[be.TOP_LEFT]=new this._classConstructor({x:t,y:r,width:n,height:i},e,this._maxDepth,this._maxChildren),this.nodes[be.TOP_RIGHT]=new this._classConstructor({x:a,y:r,width:n,height:i},e,this._maxDepth,this._maxChildren),this.nodes[be.BOTTOM_LEFT]=new this._classConstructor({x:t,y:o,width:n,height:i},e,this._maxDepth,this._maxChildren),this.nodes[be.BOTTOM_RIGHT]=new this._classConstructor({x:a,y:o,width:n,height:i},e,this._maxDepth,this._maxChildren)},be.prototype.clear=function(){this.children.length=0;var e,t=this.nodes.length;for(e=0;e<t;e++)this.nodes[e].clear();this.nodes.length=0},ke.prototype=new be,ke.prototype._classConstructor=ke,ke.prototype._stuckChildren=null,ke.prototype._out=[],ke.prototype.insert=function(e){if(this.nodes.length){var t=this._findIndex(e),r=this.nodes[t];e.x>=r._bounds.x&&e.x+e.width<=r._bounds.x+r._bounds.width&&e.y>=r._bounds.y&&e.y+e.height<=r._bounds.y+r._bounds.height?this.nodes[t].insert(e):this._stuckChildren.push(e)}else{this.children.push(e);var n=this.children.length;if(this._depth<this._maxDepth&&n>this._maxChildren){var i;for(this.subdivide(),i=0;i<n;i++)this.insert(this.children[i]);this.children.length=0}}},ke.prototype.getChildren=function(){return this.children.concat(this._stuckChildren)},ke.prototype.retrieve=function(e){var t=this._out;if(t.length=0,this.nodes.length){var r=this._findIndex(e),n=this.nodes[r];e.x>=n._bounds.x&&e.x+e.width<=n._bounds.x+n._bounds.width&&e.y>=n._bounds.y&&e.y+e.height<=n._bounds.y+n._bounds.height?t.push.apply(t,this.nodes[r].retrieve(e)):(e.x<=this.nodes[be.TOP_RIGHT]._bounds.x&&(e.y<=this.nodes[be.BOTTOM_LEFT]._bounds.y&&t.push.apply(t,this.nodes[be.TOP_LEFT].getAllContent()),e.y+e.height>this.nodes[be.BOTTOM_LEFT]._bounds.y&&t.push.apply(t,this.nodes[be.BOTTOM_LEFT].getAllContent())),e.x+e.width>this.nodes[be.TOP_RIGHT]._bounds.x&&(e.y<=this.nodes[be.BOTTOM_RIGHT]._bounds.y&&t.push.apply(t,this.nodes[be.TOP_RIGHT].getAllContent()),e.y+e.height>this.nodes[be.BOTTOM_RIGHT]._bounds.y&&t.push.apply(t,this.nodes[be.BOTTOM_RIGHT].getAllContent())))}return t.push.apply(t,this._stuckChildren),t.push.apply(t,this.children),t},ke.prototype.getAllContent=function(){var e,t=this._out;if(this.nodes.length)for(e=0;e<this.nodes.length;e++)this.nodes[e].getAllContent();return t.push.apply(t,this._stuckChildren),t.push.apply(t,this.children),t},ke.prototype.clear=function(){this._stuckChildren.length=0,this.children.length=0;var e=this.nodes.length;if(e){var t;for(t=0;t<e;t++)this.nodes[t].clear();this.nodes.length=0}},_e.prototype.root=null,_e.prototype.insert=function(e){if(e instanceof Array){var t,r=e.length;for(t=0;t<r;t++)this.root.insert(e[t])}else this.root.insert(e)},_e.prototype.clear=function(){this.root.clear()},_e.prototype.retrieve=function(e){return this.root.retrieve(e).slice(0)};var Oe=_e,Ce=Object(b.default)("glycanjs:condensedlayout"),Ae=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{dx:0,dy:0,r:.5},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this.DELTA_Y,a=this.DELTA_X;if(r.collision=[],t.children.length>1&&!r.spread_count&&(r.spread_count=t.children.length,r.spread=1),!t.parent)return r;if(r.dy=-1*i,r.dx=0,!r.item_index&&n.spread_count){var o=t.parent.children;r.item_index=o.indexOf(t)+1}return n.spread&&(r.dy=-1*n.spread*i,r.dx=n.spread*a*(r.item_index-1-Math.floor(n.spread_count/2)+.5*(1-n.spread_count%2))),(!n.spread||n.spread<2)&&(r.dy+=-1*r.r),n.grid_spread&&(r.dx=a*r.item_index),r},Me=e=>{var t=e.map(e=>e.position.x),r=Math.min(...t),n=Math.max(...t)-r,i=Math.min(...t),a=Math.max(...t)-i,o=new Oe({x:r,y:i,width:n,height:a});for(var s of e.map((e,t)=>Object.assign({idx:t},e.position)))s.ignore_overlap||o.insert(s);for(var h=0;h<e.length;h++)if(!e[h].position.ignore_overlap){var l=e[h].position,c=o.retrieve(l);for(var d of c)if(d.idx!==h){var f=e[d.idx].position;if(!(f.collision.indexOf(l)>=0&&l.collision.indexOf(f)>=0)){var u=l.x-f.x,p=l.y-f.y,g=l.r+f.r;u*u+p*p<g*g&&(f.collision.push(l),l.collision.push(f))}}}},Se=(e,t)=>{return!t.parent&&1==t.children.length&&t.linkageOf(t.children[0])<0?(r=e.get(t),t.identifier,r.x=-1*r.r,r.y=1,r.width=2*r.r,r.height=2*r.r,{position:e.get(t),item:t}):(((e,t)=>{e.x=-1*e.r,e.y=-1*e.r,e.width=2*e.r,e.height=2*e.r,t&&(e.x+=t.x+t.width/2+e.dx,e.y+=t.y+t.height/2+e.dy)})(e.get(t),t.parent?e.get(t.parent):null),Ce.info("Position for",t.identifier,e.get(t).x,e.get(t).y),{position:e.get(t),item:t});var r},Te=(e,t)=>!e[t],He=(e,t)=>e.get(t),qe=(e,t)=>[...e.residues_to_root(t)],Ee=class{static get DELTA_X(){return this.LINKS,1}static get DELTA_Y(){return this.LINKS?1:.5}static LayoutMonosaccharide(e,t,r,n){return Ae.call(this,e,t,r,n)}static CalculateIdentifier(e){return e.identifier.toLowerCase()}static PerformLayout(e){for(var t=new WeakMap,r=[...e.breadth_first_traversal()],n=20;n>=0;){for(var i of(Ce.info("Looping to resolve overlaps on loop",n--),r)){var a=t.has(i)?t.get(i):void 0,o=i.parent&&t.has(i.parent)?t.get(i.parent):void 0;t.set(i,this.LayoutMonosaccharide(e,i,a,o,t))}var s=r.map(Se.bind(null,t));Me(s);var h=s.filter(e=>e.position.collision.length>0).map(e=>e.item),l=new WeakMap;for(var c of h)l.set(t.get(c),c);if(h.length<1){Ce.info("No overlaps to resolve - breaking");break}var d=new WeakMap;for(var f of h){var u=[].concat.apply([],t.get(f).collision.map(He.bind(null,l)).map(qe.bind(null,e)));for(var p of(Ce.info(f.identifier,"collides with",u[0].identifier,"at",t.get(f).x,t.get(f).y,t.get(f).collision.map(e=>[e.x,e.y]),"which is a child of",u.map(e=>e.identifier)),e.residues_to_root(f)))if(p!==f&&(d.has(p)||d.set(p,[]),u.indexOf(p)>=0)){Ce.info("Overlap root of",p.identifier,"for",f.identifier),d.get(p).push(f);break}}var g={};for(var v of[].concat(r).reverse())if(d.has(v)){var m=d.get(v).filter(Te.bind(null,g));for(var x of m)g[x]=!0;m.length>0&&(t.get(v).spread=t.get(v).spread+1,Ce.info("Increasing spread for",v.identifier,"to",t.get(v).spread))}}if(Ce.enabled)for(var y of(Ce.info("Done layout for",e.sequence),r))Ce.info("Laid out",y.identifier,t.get(y));return t}};Ee.LINKS=!0;var Ne=Ee,Le=e=>"HSO3"!==e.identifier;var Pe=class extends Ne{static CalculateIdentifier(e){var t=e.identifier.toLowerCase(),r=e.parent?e.parent.linkageOf(e):null;r===x.default.LINKAGES.N&&(r="N"),r===x.default.LINKAGES.O&&(r="O");var n=e.parent&&"hso3"===t&&r?"."+r:"";return"".concat(t).concat(n)}static get DELTA_X(){return 1.25*super.DELTA_X}static get DELTA_Y(){return 1.25*super.DELTA_Y}static LayoutMonosaccharide(e,t,r,n,i){var a=this.DELTA_Y,o=this.DELTA_X;r=Ne.LayoutMonosaccharide.call(this,e,t,r,n);var s=t.siblings;if(1==s.filter(Le).length&&("Fuc"==t.identifier||"NeuAc"==t.identifier))return"NeuAc"==t.identifier&&"Fuc"==s.filter(Le)[0].identifier?(r.dx=0,r.dy=-1*a,r.dy-=r.r,r):(r.dy=0,r.dx=[2,3].indexOf(t.parent.linkageOf(t))>=0?-1*o:o,"Fuc"==t.identifier?(r.rotate=r.dx<0?90:-90,r):(this.LINKS&&(r.dx+=(r.dx<0?-1:1)*o/4),r));if("PI"===t.identifier&&(r.r=.75),"GlcN"===t.identifier&&"PI"===t.parent.identifier)return r.dx=.5*o,r;if("EtNP"===t.identifier){var h=t.parent.linkageOf(t);2===h&&(r.dy=0,r.dx=-.66*o),6===h&&1===t.parent.children.length&&(r.dy=-1.1*a,r.dx=0),6===h&&t.parent.children.length>1&&(r.dx=.66*o,r.dy=0),r.ignore_overlap=!0}if("HSO3"===t.identifier){r.r=.25*o;var l=t.parent.linkageOf(t);return 2!==l&&6!==l&&l!==x.default.LINKAGES.N||(r.dy=.5*a,r.dx=.5*o,2!==l&&l!==x.default.LINKAGES.N||(r.dx*=-1)),3!==l&&4!==l||(r.dy=-.5*a,r.dx=.5*o,3===l&&(r.dx*=-1)),this.LINKS&&(r.dx+=(r.dx<0?-1:1)*o/4),r.ignore_overlap=!0,r}if(1==s.length&&"P"===t.identifier)return r.dy=0,r.dx=t.parent.linkageOf(t)>=0?o:-1*o,this.LINKS&&(r.dx+=(r.dx<0?-1:1)*o/4),r;if(1==s.length&&"GlcNAc"===t.identifier&&"GlcNAc"==s[0].identifier)return 3===t.parent.linkageOf(t)&&(r.dx=0),r;if(0==s.filter(Le).filter(e=>["Fuc","NeuAc"].indexOf(e.identifier)<0).length&&s.filter(Le).filter(e=>["Fuc","NeuAc"].indexOf(e.identifier)>=0).length<=1&&(r.dx=0),1===s.length&&["P","HSO3","EtNP"].indexOf(s[0].identifier)>=0&&(r.dx=0),2===s.length&&[t].concat(s).map(e=>e.identifier).indexOf("Fuc")>=0&&[t].concat(s).map(e=>e.identifier).indexOf("HSO3")>=0&&["Fuc"].indexOf(t.identifier)>=0)return r.dy=0,r.dx=t.parent.linkageOf(t)>=4?o:-1*o,"Fuc"==t.identifier&&(r.rotate=r.dx<0?90:-90),this.LINKS&&(r.dx+=(r.dx<0?-1:1)*o/4),r;if("Man"===t.identifier&&t.siblings.length>0){var c=t.siblings.map(e=>i.get(e)).filter(e=>e).map(e=>e.spread).filter(e=>e);r.spread&&c.push(r.spread);var d=Math.max(...c);if(isFinite(d)){for(var f of t.siblings)f.children.length>0&&i.get(f)&&(i.get(f).spread=d);r.spread=d}}return r}};class ze extends(we(Y)){}var Be=(e,t)=>!(!e||!t)&&e.identifier===t.identifier,Ge=new ze;Ge.sequence="Man(a1-3)[Man(a1-6)]Man(b1-4)GlcNAc(b1-4)GlcNAc";var je=new ze;je.sequence="Gal(b1-3)GalNAc";var Ie,Fe,Re=class extends Pe{static LayoutMonosaccharide(e,t,r,n,i){var a=2*this.DELTA_Y,o=this.DELTA_X;if(r=Pe.LayoutMonosaccharide.call(this,e,t,r,n,i),!t.parent)return r;var s=e.match_sugar_pattern(Ge,Be);if(s.length>0&&s[0].composition().map(e=>e.original).indexOf(t)>=0)return r;if((s=e.match_sugar_pattern(je,Be)).length>0){if("GlcNAc"===t.identifier&&3===t.parent.linkageOf(t)&&0===t.siblings.length)return r;var h=s[0].composition().map(e=>e.original);if(h.indexOf(t)>=0)return r;if(t.siblings.filter(e=>h.indexOf(e)>=0).length>0)return r}var l=t.parent.linkageOf(t),c="Fuc"===t.identifier;switch(l){case 0:r.dx=0,r.dy=-1*a;break;case 2:r.dx=-1*o,r.dy=0;break;case 3:r.dx=-1*o,r.dy=-1*a,c&&(r.rotate=90);break;case 4:r.dx=0,r.dy=-1*a,c&&(r.rotate=180);break;case 6:r.dx=1*o,r.dy=-1*a,c&&(r.rotate=225);break;case 8:r.dx=1*o,r.dy=0}return r}},De=Object(b.default)("glycanjs:fisheyelayout"),Xe=3,We=[-100,-3],Ye=!0;function Ve(){Ie=(Ie=Math.exp(Xe))/(Ie-1)*2,Fe=Xe/2}function Ke(e){var t=e.x-We[0],r=e.y-We[1],n=Math.sqrt(t*t+r*r);if(!n||n>=2)return{x:e.x,y:e.y,z:n>=2?1:10};var i=Ie*(1-Math.exp(-n*Fe))/n*.75+.25;return{x:We[0]+t*i,y:We[1]+r*i,z:Math.min(i,10)}}Ve();var Ue=e=>class extends e{static get focus(){return[].concat(We)}static set focus(e){We[0]=e[0],We[1]=e[1],Ve()}static get zoom(){return Xe}static set zoom(e){Xe=e,Ve()}static get lock_residues(){return Ye}static set lock_residues(e){Ye=e}static PerformLayout(t){De("Performing FishEyeLayout");var r=e.PerformLayout.call(this,t);for(var n of t.composition()){var i=r.get(n),[a,o,s,h]=[i.x,i.y,i.width,i.height],l=Ke({x:a+s/2,y:o+h/2}),c=Ke({x:a+s/2,y:o+h}),d=Ke({x:a+s,y:o+h/2}),f=Math.max(2*(c.y-l.y),2*(d.x-l.x));Ye?(i.x=i.x-(f-s)/2,i.y=i.y-(f-h)/2):(i.x=l.x-f/2,i.y=l.y-f/2),i.z=l.z,i.width=f,i.height=f}return r}},Je=(Ue(Pe),r("xYMM"),r("6cUb")),Qe=Symbol("C"),Ze=Symbol("H"),$e=Symbol("O"),et=Symbol("N"),tt=Symbol("P"),rt=Symbol("S"),nt=new Map;nt.set(Qe,12),nt.set(Ze,1.007825035),nt.set($e,15.99491463),nt.set(et,14.003074);var it=e=>{var t=[];for(var r of e.split(";")){var[n,i]=r.split(":");switch(i=parseInt(i),n){case"C":n=Qe;break;case"H":n=Ze;break;case"O":n=$e;break;case"N":n=et;break;case"P":n=tt;break;case"S":n=rt}t=t.concat(Array(i).fill(n))}return t};(()=>{var e={};for(var t of"\nterminii:r1:x;2:x;3:x;4:x\nname:P\ntype:ion\ncomposition:P:1;H:2;O:3\n\nterminii:r1:x;2:x;3:x;4:x\nname:S\ntype:ion\ncomposition:S:1;H:1;O:3\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4ax:OH;5eq:-;6eq:OH\nname:Gal\ntype:Hex\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4eq:OH;5eq:-;6eq:OH\nname:Hex\ncomposition:C:6;H:10;O:5\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4eq:OH;5eq:-;6eq:OH\nname:Glc\ntype:Hex\n\nterminii:r1:HOH;2eq:NAc;3eq:OH;4ax:OH;5eq:-;6eq:OH\nname:GalNAc\ntype:HexNAc\n\nterminii:r1:HOH;2eq:NAc;3eq:OH;4eq:OH;5eq:-;6eq:OH\nname:HexNAc\ncomposition:C:8;H:13;N:1;O:5\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4ax:OH;5eq:-;6eq:OH\nname:HexA\ncomposition:C:6;H:8;O:6\n\nterminii:r1:HOH;2eq:NAc;3eq:OH;4eq:OH;5eq:-;6eq:OH\nname:GlcNAc\ntype:HexNAc\n\nterminii:r2:HOH;1ax:COOH;3ax:H;4eq:OH;5eq:NHAc;6eq:-;7:OH;8:OH;9:OH\nname:NeuAc\ntype:NeuAc\ncomposition:C:11;H:17;N:1;O:8\n\nterminii:r2:HOH;1ax:COOH;3ax:H;4eq:OH;5eq:NHGc;6eq:-;7:OH;8:OH;9:OH\nname:NeuGc\ntype:NeuGc\ncomposition:C:11;H:17;N:1;O:9\n\nterminii:r1:HOH;2eq:OH;3ax:OH;4eq:OH;5eq:-;6eq:OH\nname:Man\ntype:Hex\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4ax:OH;5eq:-;6eq:OH\nname:Galf\ntype:Hex\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4ax:OH;5eq:-;6eq:OH\nname:GlcA\ntype:HexA\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4ax:OH;5eq:-;6eq:OH\nname:IdoA\ntype:HexA\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4ax:OH;5eq:-;6eq:OH\nname:Fuc\ntype:dHex\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4ax:OH;5eq:-;6eq:OH\nname:Rha\ntype:dHex\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4ax:OH;5eq:-;6eq:OH\nname:dHex\ncomposition:C:6;H:10;O:4\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4ax:-;5eq:OH\nname:Pent\ncomposition:C:5;H:8;O:4\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4ax:-;5eq:OH\nname:Xyl\ntype:Pent\n\nterminii:r1:HOH;2eq:OH;3eq:OH;4ax:-;5eq:OH\nname:Ara\ntype:Pent\n\nterminii:r1:H\nname:Me\ntype:alkyl\ncomposition:C:1;H:3\n".replace(/^\n/,"").split("\n\n")){var r={};for(var n of t.split("\n")){var[i,a]=n.split(/^([^\:]+)\:/).slice(1);switch(i){case"name":r.name=a;break;case"terminii":break;case"type":r.type=a;break;case"composition":r.composition=it(a)}}e[r.name]=r}})(),nt.get(Qe),nt.get(Ze),nt.get($e);w.TracedMonosaccharide;Ue(Pe),Ue(Re);var at=r("R9Pm"),ot=r.n(at),st=Je.default.Canvas,ht=(e,t,r)=>parseFloat((Math.round(e/t)*t).toFixed(r)),lt=e=>class extends e{static PerformLayout(t){var r=e.PerformLayout.call(this,t);for(var n of t.composition()){var i=r.get(n);i&&(i.x=ht(i.x,.125,3),i.y=ht(i.y,.125,3))}return r}};class ct extends Je.default{constructor(e,t){var r;e instanceof HTMLCanvasElement?r=e:(r=e.ownerDocument.createElement("canvas"),e.appendChild(r));var n=e.ownerDocument.createElement("canvas");n.offscreen="offscreen",r.offscreen="onscreen",super(r,lt(t)),this.offscreen=n,this.onscreen=r,Object.defineProperty(r,"screenToCanvasMatrix",{get:function(){return n.screenToCanvasMatrix}}),Object.defineProperty(n,"getBoundingClientRect",{get:function(){return()=>r.getBoundingClientRect()}}),this.offscreen.width="1px",this.offscreen.height="1px",this.element=new st(this.offscreen);var i=new ot.a(this.onscreen.getContext("2d"),12.5);this.legra=i}renderLinkage(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=Je.default.prototype.renderLinkage.call(this,...t);if(n){for(var i of n.torender)i.options&&i.options["stroke-width"]&&(i.options["stroke-width"]=12.5,i.options.stroke="#777");return n}}paint(){Je.default.prototype.paint.call(this),setTimeout(()=>{this.onscreen.getContext("2d").clearRect(0,0,this.onscreen.width,this.onscreen.height);var e=this.offscreen.width,t=this.offscreen.height,r=12.5*Math.ceil(e/12.5),n=12.5*Math.ceil(t/12.5);this.onscreen.width=r,this.onscreen.height=n,this.legra.drawImage(this.offscreen,[-.5*(r-e),-.5*(n-t)]);for(var i=this.onscreen.getContext("2d").getImageData(0,0,this.onscreen.width,this.onscreen.height),a=0;a<i.data.length;a+=4)0===i.data[a]&&0===i.data[a+1]&&0===i.data[a+2]&&(i.data[a+3]=0);this.onscreen.getContext("2d").putImageData(i,0,0)},0)}}var dt=ct,ft=m.CondensedIupac.IO;class ut extends(ft(m.Sugar)){}class pt extends m.SugarAwareLayout{static get DELTA_X(){return super.DELTA_X}static get DELTA_Y(){return.5}}class gt extends dt{paint(){dt.prototype.paint.call(this),this.onpaint&&this.onpaint()}}var vt=class{constructor(e){this.canvas=document.createElement("canvas");var t=new ut;t.sequence=e,this.sugar=t,m.SugarAwareLayout.LINKS=!1;var r=new gt(this.canvas,pt);r.onpaint=()=>{this.dirty=!0},this.renderer=r,r.addSugar(t),r.refresh()}addChild(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.sugar.root,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Gal",n=new(0,this.sugar.constructor.Monosaccharide)(r);n.anomer="u",n.parent_linkage=1,e.addChild(t,n),this.renderer.refresh()}},mt=window.devicePixelRatio||1,xt=128*mt,yt=["GlcNAc(b1-4)GlcNAc","GalNAc","Man","Glc","Fuc"],wt=(e,t)=>{e.planting=!0,t.trees[t.trees.indexOf(e)]=null,e.tween.stop(),e.scale=.5,e.y=e.y-.5*e.canvas.height,e.x=e.x-.25*e.canvas.width;var r=Math.max(.1,.5*Math.random()*.5);t.planting_trees.push(e),e.tween=new l.Tween(e).to({y:xt-r*e.canvas.height*mt,x:Math.floor(Math.random()*t.canvas.width),scale:r*mt},1e3).on("complete",()=>{t.planting_trees.splice(t.planting_trees.indexOf(e),1),t.planted_canvas.getContext("2d").drawImage(e.canvas,e.x,e.y,e.canvas.width*e.scale,e.canvas.height*e.scale)}).start()},bt=(e,t)=>{switch(e){case"Gal":return["GlcNAc","GalNAc","Fuc","Glc"].indexOf(t.r.identifier)>=0;case"GalNAc":return["GlcNAc"].indexOf(t.r.identifier)>=0;case"GlcA":return["Gal","GalNAc","Man","GlcNAc"].indexOf(t.r.identifier)>=0;case"Man":return["GlcNAc","Man"].indexOf(t.r.identifier)>=0;case"Xyl":return["Gal","Man"].indexOf(t.r.identifier)>=0;case"Fuc":return["Gal","Man","Glc"].indexOf(t.r.identifier)>=0;case"NeuAc":return["Gal"].indexOf(t.r.identifier)>=0;default:return!1}},kt=e=>{var t=e.r;t.children;for(var r of t.children)if(r.children.length>0)return!1;return!0};var _t=class{constructor(e){this.canvas=e,this.planting_trees=[],this.planting_canvas=document.createElement("canvas"),this.planting_canvas.width=e.width,this.planting_canvas.height=e.height,this.canvas.parentNode.appendChild(this.planting_canvas),this.planted_canvas=document.createElement("canvas"),this.planted_canvas.width=e.width,this.planted_canvas.height=e.height,this.canvas.parentNode.appendChild(this.planted_canvas),this.trees=Array(3).fill(null)}resize(){var e=this.canvas.width-2*this.margin,t=Math.floor(e/250);if(this.trees.length>Math.min(t,3))this.trees=this.trees.slice(0,Math.min(t,3));else for(;this.trees.length<Math.min(t,3);)this.trees.push(null);this.trees=this.trees.slice(0,Math.min(t,3)),this.activeTrees.forEach((t,r)=>{t.x=this.margin+(1+r)*(e/(this.trees.length+1))})}get activeTrees(){return this.trees.filter(e=>e)}addTree(){var e=this.trees.map((e,t)=>null===e?t:null);if(0!==e.length){var t=e[Math.floor(Math.random()*e.length)];if(t||0===t){var r=new vt(yt[Math.floor(Math.random()*yt.length)]);r.y=this.canvas.height,this.trees[t]=r,this.resize();var n=new l.Tween(r).to({y:xt},1e4).on("update",()=>{r.dirty=!0,r.y-.5*r.canvas.height<=xt&&(n.pause(),r.planting||setTimeout(()=>{r.plant()}))}).start();r.plant=wt.bind(null,r,this),r.tween=n}}}targetsFor(e){var t=this.activeTrees.map(e=>[...e.sugar.composition()].map(t=>({t:e,r:t}))).flat(),r=[bt.bind(null,e),kt,e=>e.r.children.length<2,e=>!e.t.active&&!e.r.active,e=>[...e.t.sugar.composition()].length<5].reduce((e,t)=>e.filter(t),t);return r[Math.floor(Math.random()*r.length)]}startGrowing(){this.growing=setInterval(()=>{this.addTree()},1e3)}render(){for(var e of(this.planting_canvas.getContext("2d").clearRect(0,0,this.planting_canvas.width,this.planting_canvas.height),this.planting_trees))this.planting_canvas.getContext("2d").drawImage(e.canvas,e.x,e.y,e.canvas.width*e.scale,e.canvas.height*e.scale);var t=this.activeTrees.filter(e=>e.dirty||e.paused);if(!(t.length<1))for(var r of(this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),t)){var n={width:r.canvas.width,height:r.canvas.height};this.canvas.getContext("2d").drawImage(r.canvas,0,0,n.width,n.height,r.x-.25*n.width,r.y-.5*n.height,.5*n.width,.5*n.height),r.dirty=!1}}};function Ot(e,t,r,n,i,a,o){try{var s=e[a](o),h=s.value}catch(e){return void r(e)}s.done?t(h):Promise.resolve(h).then(n,i)}function Ct(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){Ot(a,n,i,o,s,"next",e)}function s(e){Ot(a,n,i,o,s,"throw",e)}o(void 0)}))}}var At=o,Mt=o,St=new Map,Tt=function(){var e=Ct((function*(e){if(St.has(e))return St.get(e);var t=yield(e=>{var t=document.createElement("canvas");t.setAttribute("width","32px"),t.setAttribute("height","32px");var r=document.createElement("canvas"),n=new ut;n.sequence=e;var i=new gt(t,pt),a=i.ready.then(()=>new Promise(e=>{i.onpaint=()=>{setTimeout(()=>{r.width=32,r.height=32,r.getContext("2d").drawImage(t,50,50,100,100,0,0,32,32),e(r)},0)}}));return i.addSugar(n),i.refresh(),a})(e);return St.set(e,t),t}));return function(t){return e.apply(this,arguments)}}();Tt("Xyl"),Tt("Man"),Tt("Glc"),Tt("Gal"),Tt("GalNAc"),Tt("Fuc");var Ht=e=>{e.elves.length;var t,r,n=(t=e.elves,r=2,Array.from({length:Math.ceil(t.length/r)},(e,n)=>t.slice(n*r,n*r+r))),i=e.x,a=e.y,o=0;for(var s of n)s.forEach((e,t)=>{e.home={x:i+t*At,y:a+o*Mt},e.busy||(e.x=e.home.x,e.y=e.home.y)}),o++},qt=function(){var e=Ct((function*(e,t,r){e.ping=()=>{r.t.addChild(r.r,3,t),r.t.deliverycount--,r.r.active=!1,r.t.active=!1,r.t.deliverycount<1&&(r.t.tween.play(),r.t.paused=!1,[...r.t.sugar.composition()].length>=5&&r.t.plant()),delete e.ping},e.cargo=yield Tt(t),e.deliverCargoAndReturn(r.t.x,r.t.y-.5*r.t.canvas.height),r.r.active=!0,r.t.active=!0,r.t.tween.pause(),r.t.paused=!0,r.t.deliverycount=(r.t.deliverycount||0)+1}));return function(t,r,n){return e.apply(this,arguments)}}();var Et=class{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Man";this.canvas=e,this.elves=Array(t).fill(null),this.elves=this.elves.map(()=>new v(e)),this.elves.forEach(e=>{e.name=r}),this.x=0,this.y=0,this._interval=1e3,this.cargo_type=r}set population(e){for(;e>this.elves.length;)this.elves.push(new v(this.canvas));Ht(this)}get x(){return this.pack_center_x}get y(){return this.pack_center_y}set x(e){this.pack_center_x=e,Ht(this)}set y(e){this.pack_center_y=e,Ht(this)}set interval(e){window.clearInterval(this.deliveryService),this._interval=e,this.deliveryService&&this.deliverTo(this.target)}get interval(){return this._interval}deliverTo(e){this.target=e,this.deliveryService=setInterval(()=>{var e=this.elves.filter(e=>!e.busy).shift();if(e){var t=this.target.targetsFor(this.cargo_type);t&&Math.random()<.5&&qt(e,this.cargo_type,t)}},this.interval)}},Nt=()=>{var e=document.querySelector("#forest").getBoundingClientRect(),t=window.devicePixelRatio||1;for(var r of(e.width=e.width*t,e.height=e.height*t,document.querySelectorAll("#forest canvas")))r.width=e.width,r.height=e.height;return{w:e.width,h:e.height}},Lt=(Nt(),new _t(document.querySelector("#tree_canvas")));Lt.margin=1.5*Mt,Lt.resize(),Lt.startGrowing(),setInterval(()=>{requestAnimationFrame(()=>{Lt.render()})},100),fetch("images/tree.png").then(e=>e.blob()).then(e=>{var t=URL.createObjectURL(e),r=new Image,n=new Promise(e=>{r.onload=()=>{e(r)}});return r.src=t,n}).then(e=>{for(var t=Lt.planted_canvas,r=0;r<10;r++)t.getContext("2d").drawImage(e,1.5*Mt+Math.random()*(t.width-3*Mt),xt+Math.random()*(t.height-xt),Mt,Mt)});var Pt,zt,Bt=(e,t)=>{e.x=t.w*e.placement.l+(e.placement.l<=.5?Mt:-2*Mt),e.y=xt+(t.h-xt)*e.placement.t+(e.placement.t<.5?At:.5===e.placement.t?0:-2*At)},Gt=(Pt=[],(zt=new Et(document.querySelector("#elf_canvas"),3,"Man")).interval=4e3,zt.placement={t:1,l:0},Pt.push(zt),(zt=new Et(document.querySelector("#elf_canvas"),3,"Xyl")).placement={t:0,l:0},zt.interval=6e3,Pt.push(zt),(zt=new Et(document.querySelector("#elf_canvas"),3,"NeuAc")).placement={t:0,l:1},zt.interval=6e3,Pt.push(zt),(zt=new Et(document.querySelector("#elf_canvas"),2,"Gal")).placement={t:1,l:1},zt.interval=5e3,Pt.push(zt),(zt=new Et(document.querySelector("#elf_canvas"),2,"GlcA")).placement={t:.5,l:1},zt.interval=5e3,Pt.push(zt),(zt=new Et(document.querySelector("#elf_canvas"),2,"GalNAc")).placement={t:.5,l:0},zt.interval=5e3,Pt.push(zt),Pt);for(var jt of Gt)jt.deliverTo(Lt);var It=()=>{var e=Nt();for(var t of(Lt.resize(),Gt))Bt(t,e)};It(),window.addEventListener("orientationchange",(function(){setTimeout(()=>{It()},100)}),!1),setInterval(()=>{requestAnimationFrame(()=>{var e=document.querySelector("#elf_canvas");for(var t of(e.getContext("2d").clearRect(0,0,e.width,e.height),Gt))for(var r of t.elves)r.render()})},100)},VfSW:function(e,t,r){"use strict";r.r(t),r.d(t,"Tracer",(function(){return c})),r.d(t,"trace_into_class",(function(){return l})),r.d(t,"TracedMonosaccharide",(function(){return o}));var n=r("zHDQ"),i=r("+kXl"),a=Object(n.default)("glycanjs:tracing");class o extends i.default{constructor(e){return super(e.identifier),this.original=e,this}get anomer(){return this.original.anomer}get parent_linkage(){return this.original.parent_linkage}get identifier(){return this.original.identifier}set anomer(e){return this.original.anomer}set parent_linkage(e){return this.original.parent_linkage}set identifier(e){return this.original.identifier}linkageOf(e){return this.original.linkageOf(e.original)}clone(){var e=new this.constructor(this.original);return e.original=this.original,e.copyTagsFrom(this),e}}var s=(e,t,r,n,i)=>{var a=function(e,t,r){var n=e.clone();t=n.composition().filter(e=>e.original===t.original)[0];var i=new e.constructor.Monosaccharide(r);return t.addChild(t.original.linkageOf(r),i),{sugar:n,child:i}}(e,t,i);return a.child.copyTagsFrom(n),r.push(i),a.sugar},h=(e,t)=>e.composition().filter(e=>t.indexOf(e.original)>=0),l=function(e,t){var r=new Map,n=new t;for(var i of(n.root=new t.Monosaccharide(e.root),r.set(e.root,n.root),e.breadth_first_traversal()))if(i!==e.root){var a=new t.Monosaccharide(i);a=Object.assign(a,i),r.set(i,a),r.get(i.parent).addChild(i.parent.linkageOf(i),a)}return n};class c{static trace(e,t,r,n){var i=e.constructor;return function(e,t,r,n,i){var o=new WeakMap,l=[],c=new WeakMap;a.info("Tracing",n.sequence,"onto",t.sequence,"moving cursor over template");var d=[...n.breadth_first_traversal(n.root,t=>{if(a.info("Template cursor is positioned at",t.identifier),c=new WeakMap,!t.parent)return a.info("The cursor is at the root - the search sugar is at",r.identifier),l.push((n=new e,d=r,f=n.constructor.Monosaccharide,n.root=new f(d),n)),o.set(t,[l[0].composition()[0].original]),l[0].composition()[0].copyTagsFrom(t),a.info("Done with this cursor",t.identifier),l.length>0;var n,d,f;o.set(t,[]),a.info("Residues in the search tree that correspond to the cursor parent are",o.get(t.parent).map(e=>e.identifier));var u=t.parent.linkageOf(t);l=l.filter(e=>h(e,o.get(t.parent)).length>0),a.info("Current sets of sugars are",l);var p=l.map(e=>{var r=h(e,o.get(t.parent));if(r.length>1)throw new Error("Tracing mapped a template residue to more than one residue in the search sugar");return c.set(r[0],e),r[0]});for(var g of(l=[],a.info("We need to find children of the attachment points linked via a",u,"linkage"),p)){var v=g.original;a.info("Attachment point is a wrapped residue with identifier",v.identifier);var m=0==u?v.children:v.child_linkages.get(u);a.info("We want to find a match for the cursor from within",(m||[]).length,"possible child residues");var x=[].concat(m).filter(i.bind(null,t)).filter(e=>e);if(x.length>=1){var y=s.bind(null,c.get(g),g,o.get(t),t);a.info("Valid children in search sugar are",x.map(e=>e.identifier));var w=x.map(y);l=l.concat(w)}}return l.length>0})];return a.info("We mapped",d.length,"out of",n.composition().length,"residues"),a.info(l.map(e=>e.sequence)),l}(class extends i{static get Monosaccharide(){return o}},e,t,r,n)}}},XJ90:function(e,t,r){"use strict";r.r(t);var n=r("zHDQ"),i=r("+kXl"),a=r("lC8A"),o=Object(n.default)("glycanjs:renderer"),s=Symbol("canvas"),h=Symbol("cached_layout"),l=Symbol("layout"),c=Symbol("rendered_sugars"),d=Symbol("rendered_elements"),f=Symbol("group_tag"),u=Symbol("rotate"),p=e=>e.toFixed(1),g=e=>e.height,v=e=>e.width,m=function(e,t,r,n,i){var a=this.rotate,o=a?v:g,s=a?g:v,h="?";"b"===e&&(h="β"),"a"===e&&(h="α"),(t=t||"?")<0&&(t="");var[l,c,d,f]=[r.x+r.width/2,r.y+r.height/2,n.x+n.width/2,n.y+n.height/2],u=a?l-d:c-f,p=a?c-f:l-d,m=o(r)+o(n),x=a?f:d,y=a?r.x:r.y,w=a?r.y-n.y:r.x-n.x,b=a?r.x-n.x:r.y-n.y,k=p/u;isFinite(k)||(k=-1,w>0&&(k=1));var _=u,O=.75*_;Math.abs(_)>=m/2?O=.75*(_-=m/2)+o(n)/2:0==_&&(O=.425*Math.abs(p));var C=k*O;0===C&&(C+=s(r)/10);var A=100*(x+C),M=100*(y+1*o(r));0===b&&(M=100*(y+o(r)/8))>25&&(M=25);var S=this.renderLinkageLabel(i,a?M:A,a?A:M,h+t,a,C);return i.sendToBack(S),S},x=(e,t,r,n,i)=>[(1-i)*e+i*r,(1-i)*t+i*n],y=(e,t,r,n,i)=>{var a=t-n,o=r-e,s=i/Math.hypot(a,o);return[e+(a*=s),t+(o*=s),e-a,t-o]},w=(e,t,r,n,i)=>{var a=t-n,o=r-e,s=i/Math.hypot(a,o);return[e-(a*=s),t-(o*=s),e,t]},b=function(e,t,r,n,i,o){var s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(t){var h=[100*(e.x+e.width/2),100*(e.y+e.height/2),100*(t.x+t.width/2),100*(t.y+t.height/2)],l=this.renderLinkageGroup(o,i,r);o.sendToBack(l),l.line(...h,{"stroke-width":p(1),stroke:"#333"}),s&&m.call(this,r.anomer,n.linkageOf(r),e,t,l);var c=r instanceof a.default.Monosaccharide,d=n instanceof a.default.Monosaccharide;if(c&&r.endsRepeat&&0===r.children.length){var f=[100*(e.x+e.width/2),100*(e.y+e.height/2),100*(t.x+t.width/2),100*(t.y+t.height/2)],u=-1,g=.25;e.x-t.x!=0&&e.y-t.y!=0&&(g=.25);var v=x(...f,-.5),b=y(v[0],v[1],f[2],f[3],100*e.width*g),k=w(...b,100*u*e.width/8),_=w(b[2],b[3],b[0],b[1],-1*u*100*e.width/8);l.line(...b,{"stroke-width":p(5),stroke:"#999"}),l.line(...k,{"stroke-width":p(5),stroke:"#999"}),l.line(..._,{"stroke-width":p(5),stroke:"#999"})}if(c?!d:d){var O=[100*(e.x+e.width/2),100*(e.y+e.height/2),100*(t.x+t.width/2),100*(t.y+t.height/2)],C=c?1:-1,A=.25;e.x-t.x!=0&&e.y-t.y!=0&&(A=.25);var M=x(...O,C>0?.55:.5),S=y(M[0],M[1],O[2],O[3],100*e.width*A),T=w(...S,100*C*e.width/8),H=w(S[2],S[3],S[0],S[1],-1*C*100*e.width/8);l.line(...S,{"stroke-width":p(5),stroke:"#999"}),l.line(...T,{"stroke-width":p(5),stroke:"#999"}),l.line(...H,{"stroke-width":p(5),stroke:"#999"}),c&&l.text(T[2],T[3],r.repeat.identifier,{"font-size":p(Math.floor(100/3)),"text-anchor":"end",dy:"0.25em",dx:"-0.25em"})}return l}},k=function(e){var t=new Set(e);for(var r of this.rendered.keys())if(r instanceof i.default&&!t.has(r)){var n=this.rendered.get(r);this.removeRendered(n),this.rendered.delete(r)}},_=function(e,t){if(t){o.info("Laying out",e.sequence);var r=t.PerformLayout(e);return r.calculateIdentifier=t.CalculateIdentifier,r}o.info("No layout engine specified, skipping layout")},O=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.composition(),n=[],i=[],a=this.rendered.get(e),o=this.rotate;if(a=this.setupContainer(a,e),!(r.length<1)){var s=[];for(var h of t?r:[]){var c=t.get(h),d=c.x,f=c.y;o&&(c.x=f,c.y=-1*d-c.width),n.push(c.x),n.push(c.x+c.width),i.push(c.y),i.push(c.y+c.height);var u=null,p=this.rendered.get(h);p?u=p.residue:(p={residue:u=this.renderIcon(a,t.calculateIdentifier(h),h,e),linkage:null},this.rendered.set(h,p)),1!==c.z&&s.push({z:c.z,icon:u});var g=1==this[l].LINKS;p.linkage&&this.removeRendered({linkage:p.linkage}),p.linkage=this.renderLinkage(c,h.parent?t.get(h.parent):void 0,h,h.parent,e,a,g);var v=0;c.rotate&&(v=c.rotate),o&&(v-=90),this.setIconPosition(u,100*c.x,100*c.y,100*c.width,100*c.height,v)}var m=s.map(e=>e.icon.element).map(e=>[...e.parentNode.children].indexOf(e)).map((e,t,r)=>e-(r[t-1]||0)).map(e=>e>=0).reduce((e,t)=>e&&t,!0);if(!m)for(var x of s.sort((e,t)=>e.z-t.z))a.sendToFront(x.icon);if(this.groupTag&&a.tagGroup){var y=[];for(var w of e.composition_for_tag(this.groupTag)){var b=this.rendered.get(w);b&&(b.linkage&&a.tagGroup.appendChild(b.linkage),y.push(b.residue))}for(var k of y)a.tagGroup.appendChild(k.element)}return a}};t.default=class{constructor(e,t){e&&t&&(this[l]=t,this[h]=new WeakMap),this[c]=[],this[d]=new Map}get LayoutEngine(){return this[l]}set LayoutEngine(e){return this[l]=e,this[l]}static get GLOBAL_SCALE(){return 100}get element(){return this[s]}set element(e){return this[s]=e,this[s]}get rendered(){return this[d]}set groupTag(e){e!==this[f]&&this.resetTags(),this[f]=e}get groupTag(){return this[f]}addSugar(e){this[c].push(e)}get sugars(){return Object.freeze([].concat(this[c]))}layoutFor(e){if(this.global_layout.has(e)){var{x:t,y:r,width:n,height:i}=this.global_layout.get(e);return{x:t,y:r,width:n,height:i}}}refresh(){for(var e of(k.bind(this)(Array.prototype.concat(...this[c].map(e=>e.composition()))),this.global_layout=new WeakMap,this[c])){var t=_(e,this[l]);if(t)for(var r of[e,...e.composition()])this.global_layout.set(r,t.get(r));var n=e.composition();O.bind(this)(e,t,n)}return Promise.resolve()}setupContainer(){}resetTags(){}removeRendered(){}renderIcon(){}renderLinkageLabel(){}renderLinkage(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return b.call(this,...t)}get horizontal(){return this[u]}set horizontal(e){this[u]=!!e}}},bIJ9:function(e,t,r){"use strict";r.r(t);var n=r("zHDQ"),i=Object(n.default)("glycanjs:svgcanvas"),a="http://www.w3.org/2000/svg",o=e=>e.toFixed(1);t.default=class{constructor(e){i.info("Creating canvas element");var t="DEFS"===e.nodeName;this.canvas=this.createElement(t?"symbol":"svg",e.ownerDocument),this.canvas.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),e.appendChild(this.canvas)}createElement(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.canvas.ownerDocument).createElementNS(a,e)}appendChild(e){this.canvas.appendChild(e)}group(e){return e||(e=this.canvas.ownerDocument.createElementNS(a,"g"),this.appendChild(e)),Object.create(this,{appendChild:{value:t=>e.appendChild(t)},setAttribute:{value:(t,r)=>e.setAttribute(t,r)},setAttributeNS:{value:(t,r,n)=>e.setAttributeNS(t,r,n)},element:{value:e}})}use(e,t,r,n,i){var s=this.canvas.ownerDocument.createElementNS(a,"use");return s.setAttribute("x",o(t)),s.setAttribute("y",o(r)),s.setAttribute("width",o(n)),s.setAttribute("height",o(i)),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e),this.appendChild(s),s}rect(e,t,r,n){var i=this.canvas.ownerDocument.createElementNS(a,"rect");return i.setAttribute("x",o(e)),i.setAttribute("y",o(t)),i.setAttribute("width",o(r)),i.setAttribute("height",o(n)),this.appendChild(i),i}line(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=this.canvas.ownerDocument.createElementNS(a,"line");for(var h of(s.setAttribute("x1",o(e)),s.setAttribute("y1",o(t)),s.setAttribute("x2",o(r)),s.setAttribute("y2",o(n)),Object.keys(i)))s.setAttribute(h,i[h]);var[l,c,d]=[i.fill?"fill: var(--fill-color,".concat(i.fill,");"):"",i.stroke?"stroke: var(--stroke-color,".concat(i.stroke,");"):"",i["stroke-width"]?"stroke-width: var(--stroke-width,".concat(i["stroke-width"],")"):""];return s.setAttribute("style","".concat(l).concat(c).concat(d)),s.setAttribute("stroke-linecap","round"),this.appendChild(s),s}text(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this.canvas.ownerDocument.createElementNS(a,"text"),s=this.canvas.ownerDocument.createElementNS(a,"tspan");for(var h of("string"!=typeof r?i.appendChild(r):(i.appendChild(s),s.textContent=r,s.setAttribute("dy","0")),i.style.fontFamily="Helvetica, Verdana, Arial, Sans-serif",i.setAttribute("x",o(e)),i.setAttribute("y",o(t)),["font-size","text-anchor"]))n[h]&&i.setAttribute(h,n[h]);for(var l of["dy","dx"])n[l]&&s.setAttribute(l,n[l]);return this.appendChild(i),i}sendToBack(e){e.element&&(e=e.element);var t=e.parentNode;return t.insertBefore(e,t.firstChild),e}sendToFront(e){return e.element&&(e=e.element),e.parentNode.insertBefore(e,null),e}}},eJvt:function(e,t,r){"use strict";r.r(t),t.default='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="50 50 500 1300">\n\x3c!--\nRGB settings for SNFG\nWhite  #fff\nBlue  #0090bc\nGreen  #00a651\nYellow  #ffd400\nLight blue  #8fcce9\nPink  #f69ea1\nPurple  #a54399\nBrown  #a17a4d\nOrange  #f47920\nRed  #ed1c24\n--\x3e\n  <defs>\n    <symbol id="hexnac_base" viewBox="0 0 100 100">\n      <rect x="10" y="10" width="80" height="80" style="fill: var(--fill-color); stroke: var(--stroke-color); stroke-width: var(--stroke-width);" />\n    </symbol>\n    <symbol id="hex_base" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" r="40" style="fill: var(--fill-color); stroke: var(--stroke-color); stroke-width: var(--stroke-width);"/>\n    </symbol>\n    <symbol id="sia_base" viewBox="0 0 100 100">\n      <rect x="17" y="17" transform="rotate(45,50,50)" width="66" height="66" style="fill: var(--fill-color); stroke: var(--stroke-color); stroke-width: var(--stroke-width);"/>\n    </symbol>\n    <symbol id="hexnac" viewBox="0 0 100 100">\n      <rect x="10" y="10" width="80" height="80" fill="#fff" stroke-width="3" stroke="#000"/>\n    </symbol>\n    <symbol id="galnac" viewBox="0 0 100 100">\n      <rect x="10" y="10" width="80" height="80" fill="#ffd400" stroke-width="1" stroke="#000"/>\n    </symbol>\n    <symbol id="glcnac" viewBox="0 0 100 100">\n      <rect x="10" y="10" width="80" height="80" fill="#0090bc" stroke-width="1" stroke="#000"/>\n    </symbol>\n    <symbol id="man" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#00a651" r="40" stroke-width="1" stroke="#000"/>\n    </symbol>\n    <symbol id="man6p" viewBox="0 0 100 100">\n      <circle cx="50" cy="75" fill="#00a651" r="20" stroke-width="1" stroke="#000"/>\n      <text x="50" y="25" text-anchor="middle" stroke="#000" stroke-width="2" dy=".35em" dx="0.05em" font-size="25">P</text>\n    </symbol>\n    <symbol id="glc" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#0090bc" r="40" stroke-width="1" stroke="#000"/>\n    </symbol>\n    <symbol id="gal" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#ffd400" r="40" stroke-width="1" stroke="#000"/>\n    </symbol>\n    <symbol id="hex" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#fff" r="40" stroke-width="3" stroke="#000"/>\n    </symbol>\n    <symbol id="neu" viewBox="0 0 100 100">\n      <rect x="17" y="17" transform="rotate(45,50,50)" fill="#ed1c24" stroke="#000" stroke-width="1" width="66" height="66"/>\n    </symbol>\n    <symbol id="neuac" viewBox="0 0 100 100">\n      <rect x="17" y="17" transform="rotate(45,50,50)" fill="#a54399" stroke="#000" stroke-width="1" width="66" height="66"/>\n    </symbol>\n    <symbol id="neugc" viewBox="0 0 100 100">\n      <rect x="17" y="17" transform="rotate(45,50,50)" fill="#8fcce9" stroke="#000" stroke-width="1" width="66" height="66"/>\n    </symbol>\n    <symbol id="fuc" viewBox="0 0 100 100">\n      <path d="M50,15 90,90 10,90 z" fill="#ed1c24" stroke="#000" stroke-width="1"/>\n    </symbol>\n    <symbol id="fucnac" viewBox="0 0 100 100">\n      <path d="M50,15 90,90 50,90 z" fill="#ed1c24" stroke="#000" stroke-width="1"/>\n      <path d="M50,15 50,90 10,90 z" fill="#fff" stroke="#000" stroke-width="1"/>\n    </symbol>\n    <symbol id="rha" viewBox="0 0 100 100">\n      <path d="M50,15 90,90 10,90 z" fill="#00a651" stroke="#000" stroke-width="1"/>\n    </symbol>\n    <symbol id="ara" viewBox="0 0 100 100">\n<polyline fill="#00a651" stroke="#000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="\n  67.802,60.462 78.803,94.32 50.001,69.823 21.196,94.322 32.199,60.462 3.386,39.531 38.999,39.534 50,5.678 61.002,39.536 96.615,39.539 67.804,60.462 "/>\n    </symbol>\n    <symbol id="araf" viewBox="0 0 100 100">\n<polyline fill="#00a651" stroke="#000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="\n  67.802,60.462 78.803,94.32 50.001,69.823 21.196,94.322 32.199,60.462 3.386,39.531 38.999,39.534 50,5.678 61.002,39.536 96.615,39.539 67.804,60.462 "/>\n      <text x="50" y="50" text-anchor="middle" stroke="#fff" fill="#fff" stroke-width="0" dy=".4em" dx="-0.1em" font-size="50" font-family="sans-serif" font-style="italic">f</text>\n    </symbol>\n    <symbol id="xyl" viewBox="0 0 100 100">\n<polyline fill="#f47920" stroke="#000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="\n  67.802,60.462 78.803,94.32 50.001,69.823 21.196,94.322 32.199,60.462 3.386,39.531 38.999,39.534 50,5.678 61.002,39.536 96.615,39.539 67.804,60.462 "/>\n    </symbol>\n    <symbol id="rib" viewBox="0 0 100 100">\n<polyline fill="#f69ea1" stroke="#000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="\n  67.802,60.462 78.803,94.32 50.001,69.823 21.196,94.322 32.199,60.462 3.386,39.531 38.999,39.534 50,5.678 61.002,39.536 96.615,39.539 67.804,60.462 "/>\n    </symbol>\n    <symbol id="rbo" viewBox="0 0 100 100">\n<polyline fill="#f69ea1" stroke="#000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="\n  67.802,60.462 78.803,94.32 50.001,69.823 21.196,94.322 32.199,60.462 3.386,39.531 38.999,39.534 50,5.678 61.002,39.536 96.615,39.539 67.804,60.462 "/>\n    <text x="50" y="50" text-anchor="middle" stroke="#fff" fill="#fff" stroke-width="0" dy=".4em" dx="-0.1em" font-size="25" font-family="sans-serif" font-style="italic">ol</text>\n    </symbol>\n    <symbol id="hexa" viewBox="0 0 100 100">\n      <polyline fill="#fff" stroke="#000" stroke-width="1" points="50,5 95,50 5,50 50,5"/>\n      <polyline fill="#fff" stroke="#000" stroke-width="1" points="50,95 95,50 5,50 50,95"/>\n    </symbol>\n    <symbol id="glca" viewBox="0 0 100 100">\n      <polyline fill="#0090bc" stroke="#000" stroke-width="1" points="50,5 95,50 5,50 50,5"/>\n      <polyline fill="#fff" stroke="#000" stroke-width="1" points="50,95 95,50 5,50 50,95"/>\n    </symbol>\n    <symbol id="glcn" viewBox="0 0 100 100">\n      <polyline fill="#0090bc" stroke="#000" stroke-width="1" points="10,10 90,10 90,90 10,10"/>\n      <polyline fill="#fff" stroke="#000" stroke-width="1" points="10,10 90,90 10,90 10,10"/>\n    </symbol>\n    <symbol id="idoa" viewBox="0 0 100 100">\n      <polyline fill="#fff" stroke="#000" stroke-width="1" points="50,5 95,50 5,50 50,5"/>\n      <polyline fill="#a17a4d" stroke="#000" stroke-width="1" points="50,95 95,50 5,50 50,95"/>\n    </symbol>\n    <symbol id="cer" viewBox="0 0 100 100">\n      <path fill="#fff" stroke="#000" stroke-width="4" stroke-linecap="round" d="M35.8,15 64.2,15 75.5,27.2 64.2,38.3 75.5,50 64.2,61.1 75.5,72 64.2,83 75.5,94 L75.5,110 L35.8,110"/>\n      <path fill="#fff" stroke="#999" stroke-width="4" stroke-linecap="round"  d="M35.8,15 24.5,27.2 35.8,38.3 24.5,50 35.8,61.1 24.5,72 35.8,83 24.5,94"/>\n    </symbol>\n    \x3c!--\n    <symbol id="man(a1-2)man" viewBox="0 0 100 100">\n      <svg viewBox="0 0 100 100" x="0" y="0" width="100" height="50">\n        <circle cx="50" cy="50" fill="#00a651" r="40" stroke-width="1" stroke="#000"/>\n      </svg>\n      <svg viewBox="0 0 100 100" x="0" y="50" width="100" height="50">\n        <circle cx="50" cy="50" fill="#00a651" r="40" stroke-width="1" stroke="#000"/>\n      </svg>\n    </symbol>\n    <symbol id="neuac(a2-3)gal(b1-3)galnac" viewBox="0 0 100 100">\n      <svg viewBox="0 0 100 100" x="0" y="0" width="100" height="33">\n        <rect x="17" y="17" transform="rotate(45,50,50)" fill="#a54399" stroke="#000" stroke-width="1" width="66" height="66"/>\n      </svg>\n      <svg viewBox="0 0 100 100" x="0" y="33" width="100" height="33">\n        <circle cx="50" cy="50" fill="#ffd400" r="40" stroke-width="1" stroke="#000"/>\n      </svg>\n      <svg viewBox="0 0 100 100" x="0" y="66" width="100" height="33">\n        <rect x="10" y="10" width="80" height="80" fill="#ffd400" stroke-width="1" stroke="#000"/>\n      </svg>\n    </symbol>\n    <symbol id="gal(b1-3)galnac" viewBox="0 0 100 100">\n      <svg viewBox="0 0 100 100" x="0" y="0" width="100" height="50">\n        <circle cx="50" cy="50" fill="#ffd400" r="40" stroke-width="1" stroke="#000"/>\n      </svg>\n      <svg viewBox="0 0 100 100" x="0" y="50" width="100" height="50">\n        <rect x="10" y="10" width="80" height="80" fill="#ffd400" stroke-width="1" stroke="#000"/>\n      </svg>\n    </symbol>\n    <symbol id="glcnac(b1-4)glcnac" viewBox="0 0 100 100">\n      <svg viewBox="0 0 100 100" x="0" y="0" width="100" height="50">\n        <rect x="10" y="10" width="80" height="80" fill="#0090bc" stroke-width="1" stroke="#000"/>\n      </svg>\n      <svg viewBox="0 0 100 100" x="0" y="50" width="100" height="50">\n        <rect x="10" y="10" width="80" height="80" fill="#0090bc" stroke-width="1" stroke="#000"/>\n      </svg>\n    </symbol>\n    <symbol id="man(a1-3)[man(a1-6)]man(b1-4)glcnac(b1-4)glcnac" viewBox="0 0 100 100">\n      <svg viewBox="0 0 100 100" x="50" y="0" width="25" height="25">\n        <circle cx="50" cy="50" fill="#00a651" r="40" stroke-width="1" stroke="#000"/>\n      </svg>\n      <svg viewBox="0 0 100 100" x="25" y="0" width="25" height="25">\n        <circle cx="50" cy="50" fill="#00a651" r="40" stroke-width="1" stroke="#000"/>\n      </svg>\n      <svg viewBox="0 0 100 100" x="37.5" y="25" width="25" height="25">\n        <circle cx="50" cy="50" fill="#00a651" r="40" stroke-width="1" stroke="#000"/>\n      </svg>\n      <svg viewBox="0 0 100 100" x="37.5" y="50" width="25" height="25">\n        <rect x="10" y="10" width="80" height="80" fill="#0090bc" stroke-width="1" stroke="#000"/>\n      </svg>\n      <svg viewBox="0 0 100 100" x="37.5" y="75" width="25" height="25">\n        <rect x="10" y="10" width="80" height="80" fill="#0090bc" stroke-width="1" stroke="#000"/>\n      </svg>\n    </symbol>\n    <symbol id="glcnac(b1-4)glcnac.potential" viewBox="0 0 100 100">\n      <svg viewBox="0 0 100 100" x="0" y="0" width="100" height="50">\n        <rect x="10" y="10" width="80" height="80" fill="#67a2fc" stroke-width="0" stroke="#000"/>\n      </svg>\n      <svg viewBox="0 0 100 100" x="0" y="50" width="100" height="50">\n        <rect x="10" y="10" width="80" height="80" fill="#67a2fc" stroke-width="0" stroke="#000"/>\n      </svg>\n    </symbol>\n    --\x3e\n    <symbol id="phospho" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#fff" r="48" stroke-width="3" stroke="#000"/>\n      <text x="50" y="50" text-anchor="middle" stroke="#000" stroke-width="2" dy=".35em" dx="0.05em" font-size="50">P</text>\n    </symbol>\n    <symbol id="hso3" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#fdbbbb" r="35" stroke-width="4" stroke="#aa3030"/>\n      <text x="50" y="50" text-anchor="middle" fill="#aa3030" stroke="none" stroke-width="2" dy=".35em" dx="0.05em" font-size="50">S</text>\n    </symbol>\n    <symbol id="hso3.2" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#fdbbbb" r="35" stroke-width="4" stroke="#aa3030"/>\n      <text x="50" y="50" text-anchor="middle" fill="#aa3030" stroke="none" stroke-width="2" dy=".35em" dx="0.05em" font-size="30">2S</text>\n    </symbol>\n    <symbol id="hso3.3" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#fdbbbb" r="35" stroke-width="4" stroke="#aa3030"/>\n      <text x="50" y="50" text-anchor="middle" fill="#aa3030" stroke="none" stroke-width="2" dy=".35em" dx="0.05em" font-size="30">3S</text>\n    </symbol>\n    <symbol id="hso3.4" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#fdbbbb" r="35" stroke-width="4" stroke="#aa3030"/>\n      <text x="50" y="50" text-anchor="middle" fill="#aa3030" stroke="none" stroke-width="2" dy=".35em" dx="0.05em" font-size="30">4S</text>\n    </symbol>\n    <symbol id="hso3.6" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#fdbbbb" r="35" stroke-width="4" stroke="#aa3030"/>\n      <text x="50" y="50" text-anchor="middle" fill="#aa3030" stroke="none" stroke-width="2" dy=".35em" dx="0.05em" font-size="30">6S</text>\n    </symbol>\n    <symbol id="hso3.N" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#fdbbbb" r="35" stroke-width="4" stroke="#aa3030"/>\n      <text x="50" y="50" text-anchor="middle" fill="#aa3030" stroke="none" stroke-width="2" dy=".35em" dx="0.05em" font-size="30">NS</text>\n    </symbol>\n    <symbol id="p" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#bbe5fa" r="35" stroke-width="4" stroke="#2f5fac"/>\n      <text x="50" y="50" text-anchor="middle" fill="#2f5fac" stroke="none" stroke-width="2" dy=".35em" dx="0.05em" font-size="50">P</text>\n    </symbol>\n    <symbol id="p" viewBox="0 0 100 100">\n      <circle cx="50" cy="50" fill="#bbe5fa" r="35" stroke-width="4" stroke="#2f5fac"/>\n      <text x="50" y="50" text-anchor="middle" fill="#2f5fac" stroke="none" stroke-width="2" dy=".35em" dx="0.05em" font-size="50">P</text>\n    </symbol>\n    <symbol id="ser" viewBox="0 0 100 100">\n      <path d="M20,50 a1,1 0 0,0 30,0 a1,1 0 0,1 30,0" fill="none" stroke="#000" stroke-width="1"/>\n      <text x="50" y="98" text-anchor="middle" fill="#000" stroke="#000" stroke-width="0" font-size="40">Ser</text>\n    </symbol>\n    <symbol id="thr" viewBox="0 0 100 100">\n      <path d="M20,50 a1,1 0 0,0 30,0 a1,1 0 0,1 30,0" fill="none" stroke="#000" stroke-width="1"/>\n      <text x="50" y="98" text-anchor="middle" fill="#000" stroke="#000" stroke-width="0" font-size="40">Thr</text>\n    </symbol>\n    <symbol id="asn" viewBox="0 0 100 100">\n      <path d="M20,50 a1,1 0 0,0 30,0 a1,1 0 0,1 30,0" fill="none" stroke="#000" stroke-width="1"/>\n      <text x="50" y="98" text-anchor="middle" fill="#000" stroke="#000" stroke-width="0" font-size="40">Asn</text>\n    </symbol>\n    <symbol id="hyl" viewBox="0 0 100 100">\n      <path d="M20,50 a1,1 0 0,0 30,0 a1,1 0 0,1 30,0" fill="none" stroke="#000" stroke-width="1"/>\n      <text x="50" y="98" text-anchor="middle" fill="#000" stroke="#000" stroke-width="0" font-size="40">Hyl</text>\n    </symbol>\n    <symbol id="etnp" viewBox="0 0 100 100">\n      <path d="M72.109,55.693h12.039c2.38,0,4.302,0.674,5.765,2.023c1.464,1.35,2.196,3.245,2.196,5.687\n        c0,2.101-0.653,3.929-1.959,5.486s-3.304,2.336-5.996,2.336h-8.401v11.373h-3.644V55.693z M86.245,59.392\n        c-0.799-0.378-1.897-0.567-3.291-0.567h-7.201v9.323h7.201c1.625,0,2.943-0.348,3.955-1.044c1.012-0.696,1.519-1.923,1.519-3.681\n        C88.427,61.444,77.7,50.101,76.245,49.392z"/>\n       <path d="M10,10h4.052l12.663,20.516V10H30v25.392h-3.865L13.285,14.901v20.492H10V10z"/>\x3c!--"/>--\x3e\n      <polyline fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" points="38.202,22.696 57.491,41.848 52.509,46.866 47.527,51.884 63.907,68.148 "/>\n    </symbol>\n\n    <symbol id="pi" viewBox="0 0 100 100">\n  <path d="M40.5,37.048h12.039c2.38,0,4.302,0.674,5.765,2.023c1.464,1.35,2.196,3.245,2.196,5.687c0,2.101-0.653,3.929-1.959,5.486\n    c-1.306,1.557-3.304,2.336-5.996,2.336h-8.401v11.373H40.5V37.048z M54.636,40.747c-0.799-0.378-1.897-0.567-3.291-0.567h-7.201\n    v9.323h7.201c1.625,0,2.943-0.348,3.955-1.044s1.519-1.923,1.519-3.681C56.819,42.799,56.091,41.456,54.636,40.747z"/>\n<polyline fill="none" stroke="#000000" stroke-miterlimit="10" points="12.076,90.888 12.076,54.475 33.525,54.475 "/>\n<line fill="none" stroke="#000000" stroke-miterlimit="10" x1="22.8" y1="80.746" x2="22.8" y2="54.475"/>\n<polygon fill="#fff" stroke="#000000" stroke-miterlimit="10" points="50.482,3.475 38.46,10.415 38.46,24.297 50.482,31.237 \n  62.503,24.297 62.503,10.415 "/>\n<line fill="none" stroke="#000000" stroke-miterlimit="10" x1="50.482" y1="35.021" x2="50.482" y2="31.237"/>\n    </symbol>\n\n  </defs>\n  \x3c!--\n  <g>\n    <rect x="0" y="0" width="100" height="100" stroke-width="0.1" stroke="#000" fill="none"/>\n    <text x="20" y="50" font-family="helvetica">100 x 100</text>\n    <text x="0" y="15"  font-family="helvetica">0</text>\n    <text x="70" y="100"  font-family="helvetica">100</text>\n  </g>\n  --\x3e\n  <use xlink:href="#galnac" x="100" y="100" width="100" height="100"/>\n  <use xlink:href="#glcnac" x="200" y="100" width="100" height="100"/>\n  <use xlink:href="#man" x="300" y="100" width="100" height="100"/>\n  <use xlink:href="#glc" x="400" y="100" width="100" height="100"/>\n  <text x="150" text-anchor="middle" y="210">GalNAc</text>\n  <text x="250" text-anchor="middle" y="210">GlcNAc</text>\n  <text x="350" text-anchor="middle" y="210">Mannose</text>\n  <text x="450" text-anchor="middle" y="210">Glucose</text>\n  <use xlink:href="#fuc" x="100" y="250" width="100" height="100"/>\n  <use xlink:href="#neu" x="200" y="250" width="100" height="100"/>\n  <use xlink:href="#neuac" x="300" y="250" width="100" height="100"/>\n  <use xlink:href="#neugc" x="400" y="250" width="100" height="100"/>\n  <text x="150" text-anchor="middle" y="370">Fucose</text>\n  <text x="250" text-anchor="middle" y="370">Sialic acid</text>\n  <text x="350" text-anchor="middle" y="370">NeuAc</text>\n  <text x="450" text-anchor="middle" y="370">NeuGc</text>\n\n  <use xlink:href="#ara" x="100" y="400" width="100" height="100"/>\n  <use xlink:href="#xyl" x="200" y="400" width="100" height="100"/>\n  <use xlink:href="#glca" x="300" y="400" width="100" height="100"/>\n  <use xlink:href="#idoa" x="400" y="400" width="100" height="100"/>\n\n  <text x="150" text-anchor="middle" y="510">Arabinose</text>\n  <text x="250" text-anchor="middle" y="510">Xylose</text>\n  <text x="350" text-anchor="middle" y="510">GlcA</text>\n  <text x="450" text-anchor="middle" y="510">IdoA</text>\n\n  <use xlink:href="#hexa" x="100" y="550" width="100" height="100"/>\n  <use xlink:href="#hex" x="200" y="550" width="100" height="100"/>\n  <use xlink:href="#hexnac" x="300" y="550" width="100" height="100"/>\n  <use xlink:href="#p" x="400" y="550" width="100" height="100"/>\n\n  <text x="150" text-anchor="middle" y="660">HexA</text>\n  <text x="250" text-anchor="middle" y="660">Hexose</text>\n  <text x="350" text-anchor="middle" y="660">HexNAc</text>\n  <text x="450" text-anchor="middle" y="660">P</text>\n\n  <use xlink:href="#ser" x="100" y="700" width="100" height="100"/>\n  <use xlink:href="#thr" x="200" y="700" width="100" height="100"/>\n  <use xlink:href="#asn" x="300" y="700" width="100" height="100"/>\n  <use xlink:href="#hyl" x="400" y="700" width="100" height="100"/>\n\n  <text x="150" text-anchor="middle" y="810">Ser</text>\n  <text x="250" text-anchor="middle" y="810">Thr</text>\n  <text x="350" text-anchor="middle" y="810">Asn</text>\n  <text x="450" text-anchor="middle" y="810">HyL</text>\n\n  <use xlink:href="#hso3" x="100" y="850" width="100" height="100"/>\n  <use xlink:href="#cer" x="200" y="850" width="100" height="100"/>\n  <use xlink:href="#hso3.2" x="300" y="850" width="100" height="100"/>\n  <use xlink:href="#hso3.3" x="400" y="850" width="100" height="100"/>\n\n  <text x="150" text-anchor="middle" y="960">HSO3</text>\n  <text x="250" text-anchor="middle" y="960">Cer</text>\n  <text x="350" text-anchor="middle" y="960">2S</text>\n  <text x="450" text-anchor="middle" y="960">3S</text>\n\n\n  <use xlink:href="#hso3.4" x="100" y="1000" width="100" height="100"/>\n  <use xlink:href="#hso3.6" x="200" y="1000" width="100" height="100"/>\n  <use xlink:href="#hso3.N" x="300" y="1000" width="100" height="100"/>\n  <use xlink:href="#glcn" x="400" y="1000" width="100" height="100"/>\n\n  <text x="150" text-anchor="middle" y="1110">4S</text>\n  <text x="250" text-anchor="middle" y="1110">6S</text>\n  <text x="350" text-anchor="middle" y="1110">NS</text>\n  <text x="450" text-anchor="middle" y="1110">GlcN</text>\n\n\n  <use xlink:href="#etnp" x="100" y="1150" width="100" height="100"/>\n  <use xlink:href="#pi" x="200" y="1150" width="100" height="100"/>\n  <use xlink:href="#etnp" x="300" y="1150" width="100" height="100"/>\n  <use xlink:href="#etnp" x="400" y="1150" width="100" height="100"/>\n\n  <text x="150" text-anchor="middle" y="1260">Etnp</text>\n  <text x="250" text-anchor="middle" y="1260">PI</text>\n  <text x="350" text-anchor="middle" y="1260">Etnp</text>\n  <text x="450" text-anchor="middle" y="1260">Etnp</text>\n\n\n</svg>\n'},lC8A:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return A}));var n=r("+kXl"),i=r("VfSW"),a=r("zUUD"),o=Symbol("template_sugar"),s=Symbol("last_residue"),h=Symbol("min_repeats"),l=Symbol("max_repeats"),c=Symbol("identifier"),d=Symbol("active_mode"),f=Symbol("MODE_EXPAND"),u=Symbol("MODE_MINIMAL"),p=Symbol("parent"),g=Symbol("sort_order"),v=Symbol("child_residue"),m=Symbol("repeat"),x=Symbol("counter"),y=Symbol("attachment"),w=new a.default,b={};class k{constructor(){}static get(e){return b[e]||(b[e]=new k),b[e]}}var _=(e,t,r,n,i)=>{var a=[t,k.get(i),r];return w.has(a)||w.set(a,new e(r,n,t,i)),w.get(a)},O=(e,t)=>{Object.defineProperty(e,"parent",{get:()=>{var e=t.mode===f?t.max:t.mode===u?t.min:1;return _(t.constructor.Monosaccharide,t,t[s],null,e)}})};class C extends i.TracedMonosaccharide{constructor(e,t,r,n){return super(e),this[p]=t,this[m]=r,this[x]=n,this}static is_wrapped(e){return e instanceof C}static is_not_wrapped(e){return!C.is_wrapped(e)}clone(){var e=new this.constructor(this.original,this[p],this[m].clone(),this[x]);return e.copyTagsFrom(this),e}get repeat(){return this[m]}get counter(){return this[x]}balance(){var e=this.children.map(e=>({link:this.linkageOf(e),res:e}));e.sort((e,t)=>e.link-t.link);var t=e.map(e=>e.res);(t=Object.freeze(Object(n.calculateSiblingOrder)(t))).forEach((e,t)=>{e[g]=t+1})}graft(){}addChild(e,t){if(this.repeat.mode===f&&(!this.endsRepeat||this.counter<this.repeat.max))return super.addChild(e,t);this.repeat[v].children.indexOf(t)<0&&(this.repeat[v].addChild(e,t),O(t,this.repeat))}removeChild(e,t){if(!this.endsRepeat)throw new Error("Removing a child that isnt at the end of a repeat");return this.repeat.mode===f&&(!this.endsRepeat||this.counter<this.repeat.max)?super.removeChild(e,t):this.repeat[v].removeChild(e,t)}get endsRepeat(){return this.original===this.repeat[s]}get parent(){return this[p]?this[p]:super.parent}linkageOf(e){return e instanceof C?this.endsRepeat&&e.repeat===this.repeat&&e.counter!==this.counter&&e.original===this.repeat.root.original?this.repeat.root.parent.linkageOf(this.repeat.root):this.original.linkageOf(e.original):this.endsRepeat&&this.repeat.children.indexOf(e)>=0?this.repeat[v].linkageOf(e):new n.default(" ").linkageOf.call(this,e)}get child_linkages(){var e=super.child_linkages,t=new Map;for(var r of e.keys()){for(var n of e.get(r).filter(C.is_wrapped)){var i=n.original.parent.linkageOf(n.original);t.set(i,(t.get(i)||[]).concat(n))}for(var a of e.get(r).filter(C.is_not_wrapped))t.set(r,(t.get(r)||[]).concat(a))}return t}get children(){var e=this.repeat.mode===f?this.repeat.max:this.repeat.mode===u?this.repeat.min:1,t=this.original.children,r=super.children,n=[];this.repeat.mode===u&&(r=[]),this.endsRepeat&&this.counter>=e&&(n=this.repeat.children);var i=[];this.endsRepeat&&this.counter<e&&i.push(_(this.constructor,this.repeat,this.repeat.root.original,this,this.counter+1));var a=t.map(e=>_(this.constructor,this.repeat,e,this,this.counter)),o=Object.freeze([r,n,i].reduce((e,t)=>e.concat(t),a));return o.length>0&&o.every(e=>e[g])?Object.freeze(o.slice().sort((e,t)=>e[g]-t[g])):o}}class A{constructor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this[o]=e;var a=e.leaves()[0];if("Root"===e.root.identifier&&(e.root=e.root.children[0]),this[s]=a,t)this[s]="string"!=typeof t||t instanceof n.default?t:e.locate_monosaccharide(t);else if(1!==e.leaves.length)throw new Error("Too many leaves on repeat without defined attachment site");"string"!=typeof t&&(t=e.location_for_monosaccharide(this[s])),this[y]=t,this[h]=r,this[l]=i,this[v]=new n.default("Root")}clone(){var e=new this.constructor(this[o],this[s],this.min,this.max);return e[y]=this[y],e.identifier=this.identifier,this.mode&&(e.mode=this.mode),e}get off_main(){return this[s]!==this[o].leaves()[0]}static get Monosaccharide(){return C}static addToSugar(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;t instanceof n.default||"string"!=typeof t||(t=e.locate_monosaccharide(t)),r instanceof n.default||"string"!=typeof r||(r=e.locate_monosaccharide(r));var s=new n.default("Root");for(var h of r.children)s.graft(h);var l=t.parent,c=l.linkageOf(t);l.removeChild(c,t);var d=new e.constructor;d.root=new n.default("Root"),d.root.addChild(c,t);var f=new A(d,r,a,o);for(var u of(f.mode=i,s.children))f[v].graft(u),O(u,f);return l.addChild(c,f.root),f}static get MODE_EXPAND(){return f}static get MODE_MINIMAL(){return u}get template(){return this[o]}get root(){var e=_(C,this,this[o].root,null,this.min);if(this[o].root.parent&&!e.parent){var t=this[o].root.parent.linkageOf(this[o].root),r=this[o].root.parent.clone();r.removeChild(t,this[o].root),r.addChild(t,e)}return e}get attachment(){return this[y]}get identifier(){return this[c]||""}set identifier(e){this[c]=e}get mode(){return this[d]}set mode(e){if([u,f].indexOf(e)<0)throw new Error("Invalid mode");this[d]=e}get min(){return this[h]}get max(){return this[l]}set max(e){this[l]=e}get children(){return this[v].children}set children(e){var t=this[v];for(var r of t.children)t.removeChild(t.linkageOf(r),r);for(var n of e)n.parent?t.graft(n):t.addChild(0,n),O(n,this)}}},nZtj:function(e,t,r){"use strict";r.r(t);var n=Symbol("torender");var i=function(e){var t=e.getContext("2d");t.font="".concat(this.options["font-size"]||25,"px Helvetica"),t.textAlign="left",this.options["text-anchor"]&&(t.textAlign=this.options["text-anchor"]),t.textBaseline="top",this.options.dy&&(t.textBaseline="middle"),t.fillStyle="#111",t.fillText(this.text,this.x,this.y)},a=function(e){var t=e.getContext("2d");this.options["stroke-width"]&&(t.lineWidth=this.options["stroke-width"]),this.options.stroke&&(t.strokeStyle=this.options.stroke),t.beginPath(),t.moveTo(this.x,this.y),t.lineTo(this.x2,this.y2),t.stroke()},o=new Map,s=function(e){var t=e.getContext("2d"),r=o.get(this.src);r||((r=new Image).src=this.src,r.loaded=new Promise(e=>{r.addEventListener("load",e)})),o.set(this.src,r),r.loaded.then(()=>{t.drawImage(r,this.x,this.y,this.width,this.height)})};class h extends class{constructor(){this[n]=[]}get torender(){return this[n]}appendChild(e){e.parent&&e.parent.torender.splice(e.parent.torender.indexOf(e),1),e.parent=this,this.torender.push(e)}sendToBack(e){return e.parent.torender.unshift(e.parent.torender.splice(e.parent.torender.indexOf(e),1)[0]),e}sendToFront(e){return e.parent.torender.push(e.parent.torender.splice(e.parent.torender.indexOf(e),1)[0]),e}remove(e){this.torender.splice(this.torender.indexOf(e),1)}}{constructor(e){super(),e&&(this.canvas=e)}createElement(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.canvas.ownerDocument).createElement(e)}group(e){return e||(e=new h,this.appendChild(e)),e}use(e,t,r,n,i){var a={icon:e,x:t,y:r,width:n,height:i,render:s};return this.appendChild(a),a}rect(){}line(e,t,r,n){var i={x:e,y:t,x2:r,y2:n,options:arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},render:a};return this.appendChild(i),i}text(e,t,r){var n={x:e,y:t,text:r,options:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},render:i};return this.appendChild(n),n}}t.default=h},qjPz:function(e,t,r){"use strict";r.r(t),t.default=function(e,t){if(!(e instanceof CanvasRenderingContext2D))throw"Need a 2D canvas context.";t=Object.assign({handleScale:!1,handleTransforms:!1,handleResize:!0,handleScroll:!0,onchange:null,matrix:null,plugins:[]},t);var r,n,i,a,o,s,h,l=this,c=Object.defineProperty.bind(Object),d="currentTransform"in e||"mozCurrentTransform"in e,f=t.plugins,u=e.canvas,p=t.matrix,g=p?p.inverse():null,v=t.handleScale,m=t.handleTransforms&&(d||p),x=p?function(e){var t=g.applyToPoint(e.x,e.y);return{x:t.x,y:t.y,timeStamp:e.timeStamp}}:function(t){var r,n,i=e.currentTransform||e.mozCurrentTransform;i instanceof SVGMatrix&&(i=DOMMatrix.fromMatrix(i));return r=void 0===i.a?new DOMMatrix(i):i,n=r.invertSelf(),{x:t.x*n.a+t.y*n.c+n.e,y:t.x*n.b+t.y*n.d+n.f,timeStamp:t.timeStamp}};function y(){p&&!p._xx&&(p._xx=p._x,p._x=function(){return g=this.inverse(),this._xx()})}function w(){var e=u.getBoundingClientRect(),t=getComputedStyle(u),r=t.getPropertyValue.bind(t),l=parseFloat,c="padding-",d="border-",f="-width",p="left",g="right",v="bottom";s=l(r(c+p))+l(r(d+p+f)),h=l(r(c+"top"))+l(r(d+"top"+f)),n=e.left+s,i=e.top+h,a=u.width/(e.width-(s+l(r(c+g))+l(r(d+g+f))))||1,o=u.height/(e.height-(h+l(r(c+v))+l(r(d+v+f))))||1}function b(){cancelAnimationFrame(r),r=requestAnimationFrame(_)}function k(){cancelAnimationFrame(r),r=requestAnimationFrame(O)}function _(){w(),t.onchange&&t.onchange({type:"resize",timeStamp:Date.now()})}function O(){var e=u.getBoundingClientRect();n=e.left+s,i=e.top+h,t.onchange&&t.onchange({type:"scroll",timeStamp:Date.now()})}!m||d||p||(console.log("currentTransform not supported by browser"),m=!1),this.getPos=function(e){var t,r={x:(t=e).clientX-n,y:t.clientY-i,timeStamp:t.timeStamp};if(v&&(r=function(e){return e.x*=a,e.y*=o,e}(r)),m&&(r=x(r)),f.length)for(var s=0;s<f.length;s++)r=f[s].handler(e,r);return r},this.getPosXY=function(e,t){var r;return 1===arguments.length?(t=e.y,r=e.x):r=e,l.getPos({clientX:r/a+n,clientY:t/o+i,timestamp:Date.now()})},this.addPlugin=function(e){f.indexOf(e)<0&&f.push(e)},this.removePlugin=function(e){var t=f.indexOf(e);t>-1&&f.splice(t,1)},this.init=w,this.update=O,c(l,"handleScale",{get:function(){return v},set:function(e){v=!!e}}),c(l,"handleTransforms",{get:function(){return m},set:function(e){m=!!e&&(d||p)}}),c(l,"handleScroll",{get:function(){return t.handleScroll},set:function(e){e?(window.addEventListener("scroll",k),t.handleScroll=!0):(window.removeEventListener("scroll",k),t.handleScroll=!1)}}),c(l,"handleResize",{get:function(){return t.handleResize},set:function(e){e?(window.addEventListener("resize",b),t.handleResize=!0):(window.removeEventListener("resize",b),t.handleResize=!1)}}),c(l,"onchange",{get:function(){return t.onchange},set:function(e){t.onchange=e}}),c(l,"matrix",{get:function(){return p},set:function(e){p=e,m=m&&(d||p),y()}}),y(),w(),l.handleResize=t.handleResize,l.handleScroll=t.handleScroll}},xYMM:function(e,t,r){"use strict";r.r(t),function(e){var n,i=r("zHDQ"),a=r("bIJ9"),o=r("XJ90"),s=Object(i.default)("glycanjs:svgrenderer"),h=Symbol("document_container"),l="https://glycocode.com/glycanjs",c={side:1,top:1},d="object"!=typeof e||"object"!=typeof e.versions||void 0===e.versions.node?r("eJvt").default:"",f=e=>e.toFixed(1),u=function(e,t){for(var r of"mousemove mousedown mouseup click touchstart touchend touchmove drop dragover".split(" "))e.addEventListener(r,t,{passive:!0,capture:!0})},p=function(e,t){var r=this.rotate;if(t.clientX){var n=e.createSVGPoint();n.x=t.clientX,n.y=t.clientY;var i=n.matrixTransform(e.getScreenCTM().inverse()),a=i.x/100,o=i.y/100;t.sugarX=r?-1*o+1:a,t.sugarY=r?a:o}};class g extends o.default{constructor(e,t){s("SVGRenderer"),super(e,t),e&&t&&(this[h]=e,this.element=new a.default(e),this.element.canvas.setAttribute("xmlns:glycanjs",l),u(this.element.canvas,p.bind(this,this.element.canvas)))}static get SYMBOLS(){return d}static get GLOBAL_SCALE(){return 100}static fromSVGElement(e,t){var r=new n;r[h]=e.parentNode,r.element=new a.default(e),r.element.canvas=e,((e,t)=>{for(var r of e.querySelectorAll("symbol"))r.parentNode.removeChild(r);var n=e.ownerDocument.createElement("div");for(var i of(n.innerHTML=t.replace(/<\?.*\?>/,""),n.querySelectorAll("defs")))e.appendChild(i)})(e,g.SYMBOLS),(e=>{for(var t of e.querySelectorAll("symbol *[fill]")){var r=t.getAttribute("fill"),n=t.getAttribute("stroke-width"),i=t.getAttribute("stroke");r&&(t.style.fill="var(--fill-color,".concat(r,")")),n&&(t.style.strokeWidth="var(--stroke-width,".concat(n,")")),i&&(t.style.stroke="var(--stroke-color,".concat(i,")"))}for(var a of e.querySelectorAll("g[*|location] line")){var o=a.getAttribute("stroke-width"),s=a.getAttribute("stroke");o&&(a.style.strokeWidth="var(--stroke-width,".concat(o,")")),s&&(a.style.stroke="var(--stroke-color,".concat(s,")"))}})(e),u(e,p.bind(r,e));var i=e.querySelectorAll("g");for(var o of i)if(o.hasAttribute("glycanjs:sequence")){var s=new t;for(var l of(s.sequence=o.getAttribute("glycanjs:sequence"),r.addSugar(s),r.rendered.set(s,r.element.group(o)),o.querySelectorAll("use")))if(l.hasAttribute("glycanjs:location")){var c={residue:{element:l}};l.parentNode!==o&&o.appendChild(l),r.rendered.set(s.locate_monosaccharide(l.getAttribute("glycanjs:location")),c)}for(var d of o.querySelectorAll("g")){if(d.hasAttribute("glycanjs:location"))d.parentNode!==o&&(o.appendChild(d),r.element.sendToBack(d)),r.rendered.get(s.locate_monosaccharide(d.getAttribute("glycanjs:location"))).linkage=d}}return r}resetTags(){for(var e of this.sugars){var t=this.rendered.get(e);if(t.tagGroup)for(var r of[...t.tagGroup.element.childNodes])t.appendChild(r)}}setupContainer(e,t){var r=this.element;if(e||((e=r.group()).setAttributeNS(null,"pointer-events","none"),this.rendered.set(t,e)),e.setAttributeNS(l,"glycanjs:sequence",t.sequence),this.groupTag&&!e.tagGroup&&(e.tagGroup=e.group(),e.tagGroup.element.setAttribute("class","tagged")),e.tagGroup){for(var n of e.tagGroup.element.childNodes)e.appendChild(n);var i=e.tagGroup.element.ownerDocument.defaultView.getComputedStyle(e.tagGroup.element);if(i){var a=i.getPropertyValue("--zindex").trim()||0;a=parseInt(a);var o=e.tagGroup.element.parentElement;a<0&&o.insertBefore(e.tagGroup.element,o.firstChild),a>0&&o.insertBefore(e.tagGroup.element,null)}}return e}renderLinkageGroup(e,t,r){var n=e.group();return n.element.setAttributeNS(l,"glycanjs:location",t.location_for_monosaccharide(r)),n}renderLinkageLabel(e,t,r,n,i,a){var o=e.text(t,r,n);return o.setAttribute("font-size",f(Math.floor(100/3))),o.firstChild.setAttribute("dy","0.75em"),!i&&a<0&&o.setAttribute("text-anchor","end"),i&&a<0&&o.firstChild.setAttribute("dy","0em"),o}removeRendered(e){e.residue&&e.residue.element.parentNode.removeChild(e.residue.element),e.linkage&&(e.linkage.element?e.linkage.element.parentNode.removeChild(e.linkage.element):e.linkage.parentNode.removeChild(e.linkage))}renderIcon(e,t,r,n){var i=this.icon_prefix?"".concat(this.icon_prefix,"_"):"",a=e.use("#".concat(i).concat(t),0,0,1,1);return a.setAttributeNS(l,"glycanjs:identifier",r.identifier),a.setAttributeNS(l,"glycanjs:location",n.location_for_monosaccharide(r)),a.setAttributeNS(l,"glycanjs:parent",r.parent?n.location_for_monosaccharide(r.parent):""),{element:a}}setIconPosition(e,t,r,n,i,a){var o="";0!==a&&(o="rotate(".concat(f(a),",").concat(f(t+n/2),",").concat(f(r+i/2),")"));var s="".concat(o," translate(").concat(f(t),",").concat(f(r),") scale(").concat(f(n),",").concat(f(i),")");e.element.setAttribute("transform",s)}screenCoordinatesFromLayout(e){var t=this.element.canvas,r=t.createSVGPoint(),n=e.x+e.width,i=e.y+e.height;r.x=100*e.x,r.y=100*e.y;var a=r.matrixTransform(t.getScreenCTM());return e.x=a.x,e.y=a.y,r.x=100*n,r.y=100*i,a=r.matrixTransform(t.getScreenCTM()),e.width=a.x-e.x,e.height=a.y-e.y,e}scaleToFit(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,t=this.element.canvas,r=t.getBBox(),n=[r.x-100*e.side,r.y-100*e.top,r.width+200*e.side,r.height+200*e.top];t.setAttribute("viewBox",n.join(" ")),t.setAttribute("preserveAspectRatio","xMidYMid meet")}}n=class extends g{layoutFor(e){var{x:t,y:r,width:n,height:i}=this.rendered.get(e).residue.element.getBoundingClientRect();return{x:t,y:r,width:n,height:i}}screenCoordinatesFromLayout(e){return e}},t.default=g}.call(this,r("eeCk"))},zHDQ:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return n}));var n=r("oPxf")},zUUD:function(e,t,r){"use strict";function n(){this.clear()}r.r(t),n.prototype={toString:function(){return"[object MixedTupleMap]"},_hash:function(e){if(e===this._lastTuple)return this._lastHash;for(var t=e.length,r=[],n=[],i=[],a=0;a<t;a++){var o=e[a],s=typeof o;null===s||"object"!==s&&"function"!==s?(r.push("string"===s?'"'+o+'"':""+o),n.push(a)):i.push(a)}if(0===i.length)throw new Error("Tuple must have at least one non-primitive part");return r.push("["+i.concat(n).join()+"]"),this._lastTuple=e,this._lastHash={nonPrimOrder:i,primHash:r.join("/<[MI_SEP]>/")},this._lastHash},has:function(e){for(var t=this._cache,r=this._hash(e),n=r.nonPrimOrder.length,i=0;i<n;i++){var a=e[r.nonPrimOrder[i]];if(!t.has||!t.has(a))return!1;t=t.get(a)}return!!t.has&&t.has(r.primHash)},set:function(e,t){for(var r=this._cache,n=this._hash(e),i=n.nonPrimOrder.length,a=!1,o=0;o<i;o++){var s=e[n.nonPrimOrder[o]];!a&&r.has(s)?r=r.get(s):(a=!0,r.set(s,r=o<i-1?new WeakMap:new Map))}return r.set(n.primHash,t),this},get:function(e){for(var t=this._cache,r=this._hash(e),n=r.nonPrimOrder.length,i=0;i<n;i++){var a=e[r.nonPrimOrder[i]],o=t.get&&t.get(a);if(void 0===o)return o;t=o}return t.get&&t.get(r.primHash)},clear:function(){this._cache=new WeakMap,delete this._lastTuple,delete this._lastHash}},t.default=n}},[[0,"runtime","vendor"]]]);